/**
 * Parvus
 *
 * @author Benjamin de Oostfrees
 * @version 2.4.0
 * @url https://github.com/deoostfrees/parvus
 *
 * MIT license
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Parvus=t()}(this,(function(){"use strict";var e={lightboxLabel:"This is a dialog window that overlays the main content of the page. The modal displays the enlarged image. Pressing the Escape key will close the modal and bring you back to where you were on the page.",lightboxLoadingIndicatorLabel:"Image loading",lightboxLoadingError:"The requested image cannot be loaded.",controlsLabel:"Controls",previousButtonLabel:"Previous image",nextButtonLabel:"Next image",closeButtonLabel:"Close dialog window",sliderLabel:"Images",slideLabel:"Image"};return function(t){const s=window,r=['a:not([inert]):not([tabindex^="-"])','button:not([inert]):not([tabindex^="-"]):not(:disabled)','[tabindex]:not([inert]):not([tabindex^="-"])'],n={triggerElements:[],slider:null,sliderElements:[],contentElements:[]},i={};let a=0,l=null,o=null,d=0,u={},c=null,p=null,m=1,g=null,h=null,v=null,b=null,f=null,E=null,y=null,A=null,L={},w=!1,_=!1,x=!1,C=null,$=null,I=null,S=!1,T=null,M=!0;const B=window.matchMedia("(prefers-reduced-motion)"),N=()=>{B.matches?(M=!0,T=.1):(M=!1,T=u.transitionDuration)};B.addEventListener("change",N);const q=e=>{const t=e.dataset.group||`default-${a}`;return++a,e.hasAttribute("data-group")||e.setAttribute("data-group",t),t},k=e=>{if(!("A"===e.tagName&&e.hasAttribute("href")||"BUTTON"===e.tagName&&e.hasAttribute("data-target")))throw new Error("Use a link with the 'href' attribute or a button with the 'data-target' attribute. Both attributes must have a path to the image file.");if(l=q(e),i[l]||(i[l]=structuredClone(n)),i[l].triggerElements.includes(e))throw new Error("Ups, element already added.");if(i[l].triggerElements.push(e),(e=>{if(e.querySelector("img")){const t=document.createElement("div");e.classList.add("parvus-zoom"),t.className="parvus-zoom__indicator",t.innerHTML=u.lightboxIndicatorIcon,e.appendChild(t)}})(e),e.classList.add("parvus-trigger"),e.addEventListener("click",se),ve()&&l===o){const t=i[l].triggerElements.indexOf(e);X(t),O(e,t,(()=>{P(t)})),Z(),V(),K()}},F=e=>{if(!e||!e.hasAttribute("data-group"))return;const t=q(e);if(!i[t]||!i[t].triggerElements.includes(e))return;const s=i[t].triggerElements.indexOf(e);if(i[t].triggerElements.splice(s,1),i[t].sliderElements.splice(s,1),e.classList.contains("parvus-zoom")){const t=e.querySelector(".parvus-zoom__indicator");e.classList.remove("parvus-zoom"),e.removeChild(t)}ve()&&t===o&&(Z(),V(),K()),e.removeEventListener("click",se),e.classList.remove("parvus-trigger")},X=e=>{if(void 0!==i[o].sliderElements[e])return;const t=document.createElement("div"),s=document.createElement("div"),r=i[o].triggerElements.length;if(t.className="parvus__slide",t.style.position="absolute",t.style.left=100*e+"%",t.setAttribute("aria-hidden","true"),t.appendChild(s),r>1&&(t.setAttribute("role","group"),t.setAttribute("aria-label",`${u.l10n.slideLabel} ${e+1}/${r}`)),i[o].sliderElements[e]=t,e>=d){const s=(e=>{const t=i[o].sliderElements,s=t.length;for(let r=e+1;r<s;r++)if(void 0!==t[r])return r;return-1})(e);-1!==s?i[o].sliderElements[s].before(t):i[o].slider.appendChild(t)}else{const s=(e=>{const t=i[o].sliderElements;for(let s=e-1;s>=0;s--)if(void 0!==t[s])return s;return-1})(e);-1!==s?i[o].sliderElements[s].after(t):i[o].slider.prepend(t)}},Y=e=>{if(!c||!e||!e.classList.contains("parvus-trigger")||ve())return;if(o=q(e),!i[o].triggerElements.includes(e))throw new Error("Ups, I can't find the element.");d=i[o].triggerElements.indexOf(e),C=document.activeElement,history.pushState({parvus:"close"},"Image",window.location.href),ge();document.querySelectorAll('body > *:not([aria-hidden="true"])').forEach((e=>{e.setAttribute("aria-hidden","true"),e.classList.add("parvus-hidden")})),u.hideScrollbar&&(document.body.style.marginInlineEnd=s.innerWidth-document.documentElement.clientWidth+"px",document.body.style.overflow="hidden"),c.classList.add("parvus--is-opening"),c.setAttribute("aria-hidden","false"),(()=>{const e=document.createElement("div");e.className="parvus__slider",e.setAttribute("aria-hidden","true"),i[o].slider=e,c.appendChild(e)})(),X(d),i[o].slider.setAttribute("aria-hidden","false"),j(),Z(),V(),K(),ie(),D(d),O(e,d,(()=>{P(d,!0),c.classList.remove("parvus--is-opening"),i[o].slider.classList.add("parvus__slider--animate")})),z(d+1),z(d-1);const t=new CustomEvent("open",{detail:{source:e}});c.dispatchEvent(t),document.body.classList.add("parvus-is-open")},H=()=>{if(!ve())throw new Error("Ups, I'm already closed.");const e=i[o].contentElements[d],t=i[o].triggerElements[d];he(),J(),"close"===history.state?.parvus&&history.back();document.querySelectorAll(".parvus-hidden").forEach((e=>{e.removeAttribute("aria-hidden"),e.classList.remove("parvus-hidden")})),c.classList.add("parvus--is-closing"),requestAnimationFrame((()=>{const s=t.getBoundingClientRect();if(e&&"IMG"===e.tagName){const t=e.getBoundingClientRect(),r=s.width/t.width,n=s.height/t.height,i=s.left-t.left,a=s.top-t.top;e.style.transform=`translate(${i}px, ${a}px) scale(${r}, ${n})`}e.style.opacity=0,e.style.transition=`transform ${T}ms ${u.transitionTimingFunction}, opacity ${T}ms ${u.transitionTimingFunction} ${T/2}ms`}));const s=()=>{G(d),C=u.backFocus?C:i[o].triggerElements[d],C.focus({preventScroll:!0}),c.setAttribute("aria-hidden","true"),c.classList.remove("parvus--is-closing"),c.classList.remove("parvus--is-vertical-closing"),e.style.transform="",i[o].slider.remove(),i[o].slider=null,i[o].sliderElements=[],i[o].contentElements=[],e.removeEventListener("transitionend",s),u.hideScrollbar&&(document.body.style.marginInlineEnd="",document.body.style.overflow="")};e.addEventListener("transitionend",s,{once:!0});const r=new CustomEvent("close",{detail:{source:i[o].triggerElements[d]}});c.dispatchEvent(r),document.body.classList.remove("parvus-is-open")},z=e=>{e<0||e>=i[o].triggerElements.length||void 0!==i[o].sliderElements[e]||(X(e),O(i[o].triggerElements[e],e,(()=>{P(e)})))},D=e=>{i[o].sliderElements[e].setAttribute("aria-hidden","false")},O=(e,t,s)=>{const{contentElements:r,sliderElements:n}=i[o];if(void 0!==r[t])return void(s&&"function"==typeof s&&s());const a=n[t].querySelector("div"),l=new Image,d=document.createElement("div"),c=e.querySelector("img"),p=document.createElement("div");d.className="parvus__content",p.className="parvus__loader",p.setAttribute("role","progressbar"),p.setAttribute("aria-label",u.l10n.lightboxLoadingIndicatorLabel),a.appendChild(p);new Promise(((e,t)=>{l.onload=()=>e(l),l.onerror=e=>t(e)})).then((s=>{const i=e.getAttribute("data-srcset");i&&s.setAttribute("srcset",i),s.style.opacity=0,d.appendChild(s),a.appendChild(d),u.captions&&((e,t,s)=>{const r=document.createElement("div");let n=null;if(r.className="parvus__caption","self"===u.captionsSelector)t.hasAttribute(u.captionsAttribute)&&""!==t.getAttribute(u.captionsAttribute)&&(n=t.getAttribute(u.captionsAttribute));else{const e=t.querySelector(u.captionsSelector);null!==e&&(n=e.hasAttribute(u.captionsAttribute)&&""!==e.getAttribute(u.captionsAttribute)?e.getAttribute(u.captionsAttribute):e.innerHTML)}if(null!==n){const t=`parvus__caption-${s}`;r.setAttribute("aria-labelledby",t),r.id=t,r.innerHTML=`<p>${n}</p>`,e.appendChild(r)}})(a,e,t),r[t]=s,s.setAttribute("width",s.naturalWidth),s.setAttribute("height",s.naturalHeight),te(n[t],s)})).catch((()=>{const e=document.createElement("div");e.classList.add("parvus__content"),e.classList.add("parvus__content--error"),e.innerHTML=`${u.l10n.lightboxLoadingError}`,a.appendChild(e),r[t]=e})).finally((()=>{a.removeChild(p),s&&"function"==typeof s&&s()})),"A"===e.tagName?(l.setAttribute("src",e.href),l.alt=c?c.alt||"":e.getAttribute("data-alt")||""):(l.alt=e.getAttribute("data-alt")||"",l.setAttribute("src",e.getAttribute("data-target")))},P=(e,t)=>{const s=i[o].contentElements[e];if(s&&"IMG"===s.tagName){const r=i[o].triggerElements[e];if(t){const e=s.getBoundingClientRect(),t=r.getBoundingClientRect(),n=t.width/e.width,i=t.height/e.height,a=t.left-e.left,l=t.top-e.top;requestAnimationFrame((()=>{s.style.transform=`translate(${a}px, ${l}px) scale(${n}, ${i})`,s.style.transition="transform 0s, opacity 0s",requestAnimationFrame((()=>{s.style.transform="",s.style.opacity=1,s.style.transition=`transform ${T}ms ${u.transitionTimingFunction}, opacity ${T/2}ms ${u.transitionTimingFunction}`}))}))}else s.style.opacity=1}else s.style.opacity=1},R=e=>{const t=d;if(!ve())throw new Error("Oops, I'm closed.");{if("number"!=typeof e||isNaN(e))throw new Error("Oops, no slide specified.");const t=i[o].triggerElements;if(e===d)throw new Error(`Oops, slide ${e} is already selected.`);if(e<-1||e>=t.length)throw new Error(`Oops, I can't find slide ${e}.`)}void 0!==i[o].sliderElements[e]||(X(e),O(i[o].triggerElements[e],e,(()=>{P(e)}))),D(e),d=e,j(),e<t?(V("left"),z(e-1)):e>t&&(V("right"),z(e+1)),G(t),K();const s=new CustomEvent("select",{detail:{source:i[o].triggerElements[d]}});c.dispatchEvent(s)},U=()=>{d>0&&R(d-1)},W=()=>{const{triggerElements:e}=i[o];d<e.length-1&&R(d+1)},G=e=>{void 0!==i[o].sliderElements[e]&&i[o].sliderElements[e].setAttribute("aria-hidden","true")},j=()=>{o=null!==o?o:l,$=-d*c.offsetWidth,i[o].slider.style.transform=`translate3d(${$}px, 0, 0)`,I=$},V=e=>{const{triggerElements:t}=i[o],s=t.length,r=0===d,n=d===s-1,a=1===s;1===s?y.focus():r&&!a?(f.setAttribute("aria-hidden","true"),f.setAttribute("aria-disabled","true"),E.setAttribute("aria-hidden","false"),E.setAttribute("aria-disabled","false"),E.focus()):n&&!a?(f.setAttribute("aria-hidden","false"),f.setAttribute("aria-disabled","false"),E.setAttribute("aria-hidden","true"),E.setAttribute("aria-disabled","true"),f.focus()):(f.setAttribute("aria-hidden","false"),f.setAttribute("aria-disabled","false"),E.setAttribute("aria-hidden","false"),E.setAttribute("aria-disabled","false"),"left"===e?f.focus():E.focus())},K=()=>{A.textContent=`${d+1}/${i[o].triggerElements.length}`},J=()=>{L={startX:0,endX:0,startY:0,endY:0}},Q=()=>{const{startX:e,startY:t,endX:s,endY:r}=L,n=s-e,a=r-t,l=Math.abs(n),m=Math.abs(a),{triggerElements:g}=i[o],h=g.length;w?n>2&&l>=u.threshold&&d>0?U():n<2&&l>=u.threshold&&d!==h-1?W():j():_?(m>2&&u.swipeClose&&m>=u.threshold?H():(c.classList.remove("parvus--is-vertical-closing"),j()),p.style.opacity=""):j()},Z=()=>{const e=i[o].triggerElements.length,t=1===e,s=i[o].slider,r=i[o].sliderElements,n=u.simulateTouch||be(),a=s.classList.contains("parvus__slider--is-draggable");n&&u.swipeClose&&!a||n&&e>1&&!a?s.classList.add("parvus__slider--is-draggable"):s.classList.remove("parvus__slider--is-draggable"),e>1?(s.setAttribute("role","region"),s.setAttribute("aria-roledescription","carousel"),s.setAttribute("aria-label",u.l10n.sliderLabel),r.forEach(((t,s)=>{t.setAttribute("role","group"),t.setAttribute("aria-label",`${u.l10n.slideLabel} ${s+1}/${e}`)}))):(s.removeAttribute("role"),s.removeAttribute("aria-roledescription"),s.removeAttribute("aria-label"),r.forEach((e=>{e.removeAttribute("role"),e.removeAttribute("aria-label")}))),A.setAttribute("aria-hidden",1===e?"true":"false"),f.setAttribute("aria-hidden",t?"true":"false"),f.setAttribute("aria-disabled",t?"true":"false"),E.setAttribute("aria-hidden",t?"true":"false"),E.setAttribute("aria-disabled",t?"true":"false")},ee=()=>{S||(S=!0,s.requestAnimationFrame((()=>{i[o].sliderElements.forEach(((e,t)=>{te(e,i[o].contentElements[t])})),j(),S=!1})))},te=(e,t)=>{if("IMG"!==t.tagName)return;const s=getComputedStyle(e),r=e.querySelector(".parvus__caption"),n=r?r.getBoundingClientRect().height:0,i=t.getAttribute("height"),a=t.getAttribute("width");let l=e.offsetHeight,o=e.offsetWidth;l-=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom)+parseFloat(n),o-=parseFloat(s.paddingLeft)+parseFloat(s.paddingRight);const d=Math.min(o/a||0,l/i),u=a*d||0,c=i*d||0;i>c&&i<l&&a>u&&a<o||i<c&&i<l&&a<u&&a<o?(t.style.width="",t.style.height=""):(t.style.width=`${u}px`,t.style.height=`${c}px`)},se=function(e){e.preventDefault(),Y(this)},re=e=>{const{target:t}=e;t===f?U():t===E?W():(t===y||u.docClose&&!_&&!w&&t.classList.contains("parvus__slide"))&&H(),e.stopPropagation()},ne=()=>Array.from(c.querySelectorAll(r.join(", "))).filter((e=>null!==e.offsetParent)),ie=()=>{ne()[0].focus()},ae=e=>{const t=ne(),s=t.indexOf(document.activeElement),r=t.length-1;switch(e.code){case"Tab":e.shiftKey?0===s&&(t[r].focus(),e.preventDefault()):s===r&&(t[0].focus(),e.preventDefault());break;case"Escape":H(),e.preventDefault();break;case"ArrowLeft":U(),e.preventDefault();break;case"ArrowRight":W(),e.preventDefault()}},le=e=>{w=!1,_=!1,x=!0;const{pageX:t,pageY:s}=e;L.startX=t,L.startY=s;const{slider:r}=i[o];r.classList.add("parvus__slider--is-dragging"),r.style.willChange="transform",e.stopPropagation(),m=getComputedStyle(p).opacity},oe=e=>{if(x){const{pageX:t,pageY:s}=e;L.endX=t,L.endY=s,me()}e.preventDefault()},de=()=>{x=!1;const{slider:e}=i[o];e.classList.remove("parvus__slider--is-dragging"),e.style.willChange="",(L.endX||L.endY)&&Q(),J()},ue=e=>{w=!1,_=!1;const{clientX:t,clientY:s}=e.changedTouches[0];L.startX=parseInt(t),L.startY=parseInt(s);const{slider:r}=i[o];r.classList.add("parvus__slider--is-dragging"),r.style.willChange="transform",m=getComputedStyle(p).getPropertyValue("opacity"),e.stopPropagation()},ce=e=>{const{clientX:t,clientY:s}=e.changedTouches[0];L.endX=parseInt(t),L.endY=parseInt(s),me(),e.preventDefault()},pe=()=>{const{slider:e}=i[o];e.classList.remove("parvus__slider--is-dragging"),e.style.willChange="",(L.endX||L.endY)&&Q(),J()},me=()=>{const{startX:e,endX:t,startY:s,endY:r}=L,n=e-t,a=r-s,l=Math.abs(a);Math.abs(n)>2&&!_&&i[o].triggerElements.length>1?(i[o].slider.style.transform=`translate3d(${I-Math.round(n)}px, 0, 0)`,w=!0,_=!1):Math.abs(a)>2&&!w&&u.swipeClose&&(!M&&l<=100&&(p.style.opacity=m-l/100),c.classList.add("parvus--is-vertical-closing"),i[o].slider.style.transform=`translate3d(${I}px, ${Math.round(a)}px, 0)`,w=!1,_=!0)},ge=()=>{s.addEventListener("keydown",ae),s.addEventListener("resize",ee),s.addEventListener("popstate",H),c.addEventListener("click",re),be()&&(c.addEventListener("touchstart",ue),c.addEventListener("touchmove",ce),c.addEventListener("touchend",pe)),u.simulateTouch&&(c.addEventListener("mousedown",le),c.addEventListener("mouseup",de),c.addEventListener("mousemove",oe))},he=()=>{s.removeEventListener("keydown",ae),s.removeEventListener("resize",ee),s.removeEventListener("popstate",H),c.removeEventListener("click",re),be()&&(c.removeEventListener("touchstart",ue),c.removeEventListener("touchmove",ce),c.removeEventListener("touchend",pe)),u.simulateTouch&&(c.removeEventListener("mousedown",le),c.removeEventListener("mouseup",de),c.removeEventListener("mousemove",oe))},ve=()=>"false"===c.getAttribute("aria-hidden"),be=()=>"ontouchstart"in window,fe=()=>{if(u=(t=>({selector:".lightbox",gallerySelector:null,captions:!0,captionsSelector:"self",captionsAttribute:"data-caption",docClose:!0,swipeClose:!0,simulateTouch:!0,threshold:50,backFocus:!0,hideScrollbar:!0,transitionDuration:300,transitionTimingFunction:"cubic-bezier(0.62, 0.16, 0.13, 1.01)",lightboxIndicatorIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/></svg>',previousButtonIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18" /></svg>',nextButtonIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="9 6 15 12 9 18" /></svg>',closeButtonIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M18 6L6 18M6 6l12 12"/></svg>',l10n:e,...t}))(t),!document.querySelectorAll(u.selector).length)return;if(N(),c||(c=document.createElement("div"),c.setAttribute("role","dialog"),c.setAttribute("aria-modal","true"),c.setAttribute("aria-hidden","true"),c.setAttribute("tabindex","-1"),c.setAttribute("aria-label",u.l10n.lightboxLabel),c.classList.add("parvus"),p=document.createElement("div"),p.classList.add("parvus__overlay"),c.appendChild(p),g=document.createElement("div"),g.className="parvus__toolbar",h=document.createElement("div"),v=document.createElement("div"),b=document.createElement("div"),b.className="parvus__controls",b.setAttribute("role","group"),b.setAttribute("aria-label",u.l10n.controlsLabel),v.appendChild(b),y=document.createElement("button"),y.className="parvus__btn parvus__btn--close",y.setAttribute("type","button"),y.setAttribute("aria-label",u.l10n.closeButtonLabel),y.innerHTML=u.closeButtonIcon,b.appendChild(y),f=document.createElement("button"),f.className="parvus__btn parvus__btn--previous",f.setAttribute("type","button"),f.setAttribute("aria-label",u.l10n.previousButtonLabel),f.innerHTML=u.previousButtonIcon,b.appendChild(f),E=document.createElement("button"),E.className="parvus__btn parvus__btn--next",E.setAttribute("type","button"),E.setAttribute("aria-label",u.l10n.nextButtonLabel),E.innerHTML=u.nextButtonIcon,b.appendChild(E),A=document.createElement("div"),A.className="parvus__counter",h.appendChild(A),g.appendChild(h),g.appendChild(v),c.appendChild(g),document.body.appendChild(c)),null!==u.gallerySelector){document.querySelectorAll(u.gallerySelector).forEach(((e,t)=>{const s=t;e.querySelectorAll(u.selector).forEach((e=>{e.setAttribute("data-group",`parvus-gallery-${s}`),k(e)}))}))}document.querySelectorAll(`${u.selector}:not(.parvus-trigger)`).forEach(k)};return fe(),{init:fe,open:Y,close:H,select:R,previous:U,next:W,currentIndex:()=>d,add:k,remove:F,destroy:()=>{if(!c)return;ve()&&H(),c.remove();document.querySelectorAll(".parvus-trigger").forEach(F);const e=new CustomEvent("destroy");c.dispatchEvent(e)},isOpen:ve,on:(e,t)=>{c&&c.addEventListener(e,t)},off:(e,t)=>{c&&c.removeEventListener(e,t)}}}}));

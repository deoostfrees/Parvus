/**
 * Parvus
 *
 * @author de Oostfreese
 * @version 1.3.0
 * @url https://github.com/deoostfreese/parvus
 *
 * MIT license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Parvus=e()}(this,(function(){"use strict";return function t(e){const n=window,i=["button:not([disabled]):not([inert])",'[tabindex]:not([tabindex^="-"]):not([inert])'];let a,o,s,r,l={},c=null,d=null,u=0,p=null,h=null,m=null,g=null,f={},v=!1,b=!1,y=null,L=null,w=!0;const E=window.matchMedia("(prefers-reduced-motion)"),A=function(){E.matches?(w=!0,L=l.reducedTransitionDuration):(w=!1,L=l.transitionDuration)};E.addEventListener("change",A);const C=function(t){l=function(t){return{selector:".lightbox",docClose:!0,scrollClose:!1,swipeClose:!0,threshold:100,transitionDuration:300,reducedTransitionDuration:1,transitionTimingFunction:"cubic-bezier(0.2, 0, 0.2, 1)",lightboxIndicatorIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/></svg>',closeButtonIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M18 6L6 18M6 6l12 12"/></svg>',lang:"en",i18n:{en:{lightboxLabel:"This is a dialog window which overlays the main content of the page. The modal shows the enlarged image. Pressing the Escape key will close the modal and bring you back to where you were on the page.",lightboxLoadingIndicatorLabel:"Image loading",closeButtonLabel:"Close dialog window"}},fileTypes:/\.(png|jpe?g|gif|bmp|webp|svg)(\?.*)?$/i,...t}}(t),A(),c||$();document.querySelectorAll(l.selector).forEach((t=>{T(t)}))},T=function(t){if("A"===t.tagName&&t.hasAttribute("href")&&t.href.match(l.fileTypes)||"BUTTON"===t.tagName&&t.hasAttribute("data-target")&&t.getAttribute("data-target").match(l.fileTypes)){if(null!==t.querySelector("img")){t.classList.add("parvus-zoom");const e=document.createElement("div");e.className="parvus-zoom__indicator",e.innerHTML=l.lightboxIndicatorIcon,t.appendChild(e)}t.classList.add("parvus-trigger"),t.addEventListener("click",k)}else console.log(t,`Use a link with the 'href' attribute or a button with the 'data-target' attribute. Both attributes must have a path to the image file. Supported image file types: ${l.fileTypes}.`)},x=function(t){t.classList.contains("parvus-zoom")&&(t.classList.remove("parvus-zoom"),t.removeEventListener("click",k))},$=function(){c=document.createElement("div"),c.setAttribute("role","dialog"),c.setAttribute("aria-modal","true"),c.setAttribute("aria-hidden","true"),c.setAttribute("tabindex","-1"),c.setAttribute("aria-label",l.i18n[l.lang].lightboxLabel),c.classList.add("parvus"),d=document.createElement("div"),d.classList.add("parvus__overlay"),d.style.opacity=0,c.appendChild(d),p=document.createElement("div"),p.classList.add("parvus__image"),c.appendChild(p),m=document.createElement("button"),m.className="parvus__btn parvus__btn--close",m.setAttribute("type","button"),m.setAttribute("aria-label",l.i18n[l.lang].closeButtonLabel),m.innerHTML=l.closeButtonIcon,c.appendChild(m),document.body.appendChild(c)},_=function(t){if(O())throw new Error("Ups, I'm aleady open.");y=document.activeElement;const e=window.location.href;history.pushState({parvus:"close"},"Image",e),U();document.querySelectorAll('body > *:not([aria-hidden="true"])').forEach((t=>{t.setAttribute("aria-hidden","true"),t.classList.add("parvus-hidden")})),c.classList.add("parvus--is-opening"),c.setAttribute("aria-hidden","false"),S(),M(t);const n=new CustomEvent("open");c.dispatchEvent(n)},I=function(){if(!O())throw new Error("Ups, I'm already closed.");j(),Y(),null!==history.state&&"close"===history.state.parvus&&history.back();const t=new CustomEvent("close");c.dispatchEvent(t);document.querySelectorAll(".parvus-hidden").forEach((t=>{t.removeAttribute("aria-hidden"),t.classList.remove("parvus-hidden")})),c.classList.add("parvus--is-closing"),requestAnimationFrame((()=>{h.style.transform=`translate(${s}px, ${r}px) scale(${a}, ${o})`,h.style.transition=`transform ${L}ms ${l.transitionTimingFunction}`,d.style.opacity=0,d.style.transition=`opacity ${L}ms ${l.transitionTimingFunction}`})),h.addEventListener("transitionend",(()=>{y.focus({preventScroll:!0}),c.classList.remove("parvus--is-closing"),c.setAttribute("aria-hidden","true"),p.innerHTML=""}),{once:!0})},M=function(t){const e=document.createElement("figure"),n=document.createElement("figurecaption"),i=t.querySelector("img"),u=t.getBoundingClientRect();g=document.createElement("div"),g.className="parvus__loader",g.setAttribute("role","progressbar"),g.setAttribute("aria-label",l.i18n[l.lang].lightboxLoadingIndicatorLabel),c.appendChild(g),h=document.createElement("img"),"A"===t.tagName?(h.src=t.href,h.alt=i?i.alt||"":t.getAttribute("data-alt")||""):(h.alt=t.getAttribute("data-alt")||"",h.src=t.getAttribute("data-target")),p.style.opacity="0",h.style.opacity="0",e.appendChild(h),t.hasAttribute("data-caption")&&""!==t.getAttribute("data-caption")&&(n.innerHTML=t.getAttribute("data-caption"),e.appendChild(n)),p.appendChild(e),h.onload=()=>{const t=h.getBoundingClientRect();c.removeChild(g),a=u.width/t.width,o=u.height/t.height,s=u.left-t.left,r=u.top-t.top,p.style.opacity=1,h.setAttribute("width",h.naturalWidth),h.setAttribute("height",h.naturalHeight),requestAnimationFrame((()=>{h.style.transform=`translate(${s}px, ${r}px) scale(${a}, ${o})`,h.style.transition="transform 0s, opacity 0s",requestAnimationFrame((()=>{h.style.transform="",h.style.opacity=1,h.style.transition=`transform ${L}ms ${l.transitionTimingFunction}, opacity ${L}ms ${l.transitionTimingFunction}`,d.style.opacity=1,d.style.transition=`opacity ${L}ms ${l.transitionTimingFunction}`}))})),d.addEventListener("transitionend",(()=>{c.classList.remove("parvus--is-opening")}),{once:!0})}},Y=function(){d.style.opacity=1,p.style.transform="translate3d(0, 0, 0)",c.classList.remove("parvus--is-closing"),f={startY:0,endY:0}},k=function(t){t.preventDefault(),_(this)},q=function(t){(t.target===m||!v&&t.target.classList.contains("parvus__overlay")&&l.docClose)&&I(),t.stopPropagation()},B=function(){return Array.prototype.slice.call(c.querySelectorAll(`${i.join(", ")}`)).filter((function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)}))},S=function(){B()[0].focus()},D=function(t){const e=B(),n=e.indexOf(document.activeElement);"Tab"===t.code?t.shiftKey&&0===n?(e[e.length-1].focus(),t.preventDefault()):t.shiftKey||n!==e.length-1||(e[0].focus(),t.preventDefault()):"Escape"===t.code&&(t.preventDefault(),I())},F=function(){I()},H=function(t){t.stopPropagation(),v=!1,b=!0,f.startY=t.touches[0].pageY,p.classList.add("parvus__image--is-dragging")},N=function(t){t.stopPropagation(),b&&(t.preventDefault(),f.endY=t.touches[0].pageY,P())},z=function(t){t.stopPropagation(),b=!1,p.classList.remove("parvus__image--is-dragging"),f.endY&&function(){const t=f.endY-f.startY;Math.abs(t)>l.threshold&&l.swipeClose&&I()}(),Y()},P=function(){if(l.swipeClose&&!w){const t=f.endY-f.startY,e=Math.abs(t);e<=100&&(u=1-e/100),c.classList.add("parvus--is-closing"),d.style.opacity=u,p.style.transform=`translate3d(0, ${Math.round(t)}px, 0)`,v=!0}},U=function(){n.addEventListener("keydown",D),l.scrollClose&&n.addEventListener("wheel",F),n.addEventListener("popstate",I),c.addEventListener("click",q),R()&&(c.addEventListener("touchstart",H),c.addEventListener("touchmove",N),c.addEventListener("touchend",z))},j=function(){n.removeEventListener("keydown",D),l.scrollClose&&n.removeEventListener("wheel",F),n.removeEventListener("popstate",I),c.removeEventListener("click",q),R()&&(c.removeEventListener("touchstart",H),c.removeEventListener("touchmove",N),c.removeEventListener("touchend",z))},O=function(){return"false"===c.getAttribute("aria-hidden")},R=function(){return"ontouchstart"in window};return C(e),t.init=C,t.open=_,t.close=I,t.add=T,t.remove=x,t.destroy=function(){O()&&I();document.querySelectorAll(".parvus-zoom").forEach((t=>{x(t)}));const t=new CustomEvent("destroy");c.dispatchEvent(t)},t.isOpen=O,t.on=function(t,e){c.addEventListener(t,e)},t.off=function(t,e){c.removeEventListener(t,e)},t}}));

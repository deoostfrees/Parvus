/**
 * Parvus
 *
 * @author de Oostfreese
 * @version 1.2.0
 * @url https://github.com/deoostfreese/parvus
 *
 * MIT license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).parvus=e()}(this,(function(){"use strict";return function t(e){const n=window,o=["button:not([disabled]):not([inert])",'[tabindex]:not([tabindex^="-"]):not([inert])'];let i,s,a,r,l={},c=null,d=null,u=0,p=null,m=null,h=null,f=null,v={},y=!1,g=!1,b=null;const w=window.matchMedia("(prefers-reduced-motion)"),E=function(t){l=function(t){return{selector:".lightbox",lightboxLabel:"This is a dialog window which overlays the main content of the page. The modal shows the enlarged image. Pressing the Escape key will close the modal and bring you back to where you were on the page.",lightboxLoadingIndicatorLabel:"Image loading",lightboxIndicatorIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="16 4 20 4 20 8" /><line x1="14" y1="10" x2="20" y2="4" /><polyline points="8 20 4 20 4 16" /><line x1="4" y1="20" x2="10" y2="14" /><polyline points="16 20 20 20 20 16" /><line x1="14" y1="14" x2="20" y2="20" /><polyline points="8 4 4 4 4 8" /><line x1="4" y1="4" x2="10" y2="10" /></svg>',closeButtonIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path stroke="none" d="M0 0h24v24H0z"/><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></svg>',closeButtonLabel:"Close dialog window",docClose:!0,scrollClose:!0,swipeClose:!0,threshold:100,transitionDuration:300,transitionTimingFunction:"cubic-bezier(0.2, 0, 0.2, 1)",...t}}(t),c||C();document.querySelectorAll(l.selector).forEach(t=>{L(t)})},L=function(t){if(!t.classList.contains("parvus-zoom")){t.classList.add("parvus-zoom");const e=document.createElement("div");e.className="parvus-zoom__indicator",e.innerHTML=l.lightboxIndicatorIcon,t.appendChild(e),t.addEventListener("click",T)}},x=function(t){t.classList.contains("parvus-zoom")&&(t.classList.remove("parvus-zoom"),t.removeEventListener("click",T))},C=function(){c=document.createElement("div"),c.setAttribute("role","dialog"),c.setAttribute("aria-hidden","true"),c.setAttribute("tabindex","-1"),c.setAttribute("aria-label",l.lightboxLabel),c.classList.add("parvus"),d=document.createElement("div"),d.classList.add("parvus__overlay"),d.style.opacity=0,c.appendChild(d),p=document.createElement("div"),p.classList.add("parvus__image"),c.appendChild(p),h=document.createElement("button"),h.className="parvus__btn parvus__btn--close",h.setAttribute("type","button"),h.setAttribute("aria-label",l.closeButtonLabel),h.innerHTML=l.closeButtonIcon,h.style.opacity=0,c.appendChild(h),document.body.appendChild(c)},$=function(t){if(H())throw new Error("Ups, I'm aleady open.");b=document.activeElement,w.matches&&(l.transitionDuration=1);const e=window.location.href;history.pushState({parvus:"close"},"Image",e),q(),f=document.createElement("div"),f.className="parvus__loader",f.setAttribute("role","progressbar"),f.setAttribute("aria-label",l.lightboxLoadingIndicatorLabel),c.appendChild(f),c.setAttribute("aria-hidden","false"),c.focus(),A(t);const n=new CustomEvent("open");c.dispatchEvent(n)},Y=function(){if(!H())throw new Error("Ups, I'm already closed.");S(),_(),null!==history.state&&"close"===history.state.parvus&&history.back();const t=new CustomEvent("close");c.dispatchEvent(t),requestAnimationFrame(()=>{m.style.transition=`transform ${l.transitionDuration}ms ${l.transitionTimingFunction}`,m.style.transform=`translate(${a}px, ${r}px) scale(${i}, ${s})`,d.style.opacity=0,d.style.transition=`opacity ${l.transitionDuration}ms ${l.transitionTimingFunction}`,h.style.opacity=0,h.style.transition=`opacity ${l.transitionDuration}ms ${l.transitionTimingFunction}`}),m.addEventListener("transitionend",()=>{b.focus({preventScroll:!0}),c.setAttribute("aria-hidden","true"),m.remove()},{once:!0})},A=function(t){if(!t.href.match(/\.(png|jpe?g|gif|bmp|webp|svg)(\?.*)?$/i))return;m=document.createElement("img");const e=t.querySelector("img"),n=t.getBoundingClientRect();m.alt=e.alt||"",m.src=t.href,p.style.opacity="0",p.appendChild(m),m.onload=()=>{c.removeChild(f);const t=m.getBoundingClientRect();i=n.width/t.width,s=n.height/t.height,a=n.left-t.left,r=n.top-t.top,p.style.opacity=1,requestAnimationFrame(()=>{m.style.transform=`translate(${a}px, ${r}px) scale(${i}, ${s})`,m.style.transition="transform 0s",requestAnimationFrame(()=>{m.style.transform="",m.style.transition=`transform ${l.transitionDuration}ms ${l.transitionTimingFunction}`,d.style.opacity=1,d.style.transition=`opacity ${l.transitionDuration}ms ${l.transitionTimingFunction}`,h.style.opacity=1,h.style.transition=`opacity ${l.transitionDuration}ms ${l.transitionTimingFunction}`})})}},_=function(){d.style.opacity=1,p.style.transform="translate3d(0, 0, 0)",h.style.opacity=1,v={startY:0,endY:0}},T=function(t){t.preventDefault(),$(this)},D=function(t){(t.target===h||!y&&t.target.classList.contains("parvus__overlay")&&l.docClose)&&Y(),t.stopPropagation()},I=function(t){const e=Array.prototype.slice.call(document.querySelectorAll('.parvus[aria-hidden="false"], .parvus[aria-hidden="false"] '+o.join(', .parvus[aria-hidden="false"] '))).filter((function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)})),n=e.indexOf(document.activeElement);"Tab"===t.code?t.shiftKey&&0===n?(e[e.length-1].focus(),t.preventDefault()):t.shiftKey||n!==e.length-1||(e[0].focus(),t.preventDefault()):"Escape"===t.code&&(t.preventDefault(),Y())},k=function(t){Y()},M=function(t){t.stopPropagation(),y=!1,g=!0,v.startY=t.touches[0].pageY,p.classList.add("parvus__image--is-dragging")},F=function(t){t.stopPropagation(),g&&(t.preventDefault(),v.endY=t.touches[0].pageY,B())},z=function(t){t.stopPropagation(),g=!1,p.classList.remove("parvus__image--is-dragging"),v.endY&&function(){const t=v.endY-v.startY,e=Math.abs(t);t<0&&e>l.threshold&&l.swipeClose&&Y()}(),_()},B=function(){Math.abs(v.startY-v.endY)>0&&l.swipeClose&&(Math.abs(v.startY-v.endY)>=0&&Math.abs(v.startY-v.endY)<=100&&(u=1-Math.round(v.startY-v.endY)/100),d.style.opacity=u,h.style.opacity=u,p.style.transform=`translate3d(0, -${Math.round(v.startY-v.endY)}px, 0)`,y=!0)},q=function(){n.addEventListener("keydown",I),l.scrollClose&&n.addEventListener("wheel",k),n.addEventListener("popstate",Y),c.addEventListener("click",D),P()&&(c.addEventListener("touchstart",M),c.addEventListener("touchmove",F),c.addEventListener("touchend",z))},S=function(){n.removeEventListener("keydown",I),l.scrollClose&&n.removeEventListener("wheel",k),n.removeEventListener("popstate",Y),c.removeEventListener("click",D),P()&&(c.removeEventListener("touchstart",M),c.removeEventListener("touchmove",F),c.removeEventListener("touchend",z))},H=function(){return"false"===c.getAttribute("aria-hidden")},P=function(){return"ontouchstart"in window};return E(e),t.init=E,t.open=$,t.close=Y,t.add=L,t.remove=x,t.destroy=function(){H()&&Y();document.querySelectorAll(".parvus-zoom").forEach(t=>{x(t)});const t=new CustomEvent("destroy");c.dispatchEvent(t)},t.isOpen=H,t.on=function(t,e){c.addEventListener(t,e)},t.off=function(t,e){c.removeEventListener(t,e)},t}}));

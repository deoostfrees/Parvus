/**
 * Parvus
 *
 * @author de Oostfreese
 * @version 1.3.0
 * @url https://github.com/deoostfreese/parvus
 *
 * MIT license
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Parvus=t()}(this,(function(){"use strict";return function e(t){const n=window,i=["button:not([disabled]):not([inert])",'[tabindex]:not([tabindex^="-"]):not([inert])'],s={gallery:[],slider:null,sliderElements:[],elementsLength:0,currentIndex:0,x:0},a={};let r,o,l,d,c=null,u=null,p={},h=null,m=null,f=0,g=null,v=null,b={},y=!1,E=!1,L=null,A=null,w=null,x=!0;const C=window.matchMedia("(prefers-reduced-motion)"),_=function(){C.matches?(x=!0,w=p.reducedTransitionDuration):(x=!1,w=p.transitionDuration)};C.addEventListener("change",_);const I=function(e){p=function(e){return{selector:".lightbox",docClose:!0,scrollClose:!1,swipeClose:!0,threshold:100,transitionDuration:300,reducedTransitionDuration:1,transitionTimingFunction:"cubic-bezier(0.2, 0, 0.2, 1)",lightboxIndicatorIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/></svg>',closeButtonIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M18 6L6 18M6 6l12 12"/></svg>',lang:"en",i18n:{en:{lightboxLabel:"This is a dialog window which overlays the main content of the page. The modal shows the enlarged image. Pressing the Escape key will close the modal and bring you back to where you were on the page.",lightboxLoadingIndicatorLabel:"Image loading",closeButtonLabel:"Close dialog window"}},fileTypes:/\.(png|jpe?g|gif|bmp|webp|svg)(\?.*)?$/i,...e}}(e),_(),h||S();document.querySelectorAll(p.selector).forEach((e=>{$(e)}))},T=function(e){return e.hasAttribute("data-group")?e.getAttribute("data-group"):"default"},$=function(e){var t;if("A"===e.tagName&&e.hasAttribute("href")&&e.href.match(p.fileTypes)||"BUTTON"===e.tagName&&e.hasAttribute("data-target")&&e.getAttribute("data-target").match(p.fileTypes))if(c=T(e),Object.prototype.hasOwnProperty.call(a,c)||(a[c]=(t=s,JSON.parse(JSON.stringify(t))),q()),-1===a[c].gallery.indexOf(e)){if(a[c].gallery.push(e),a[c].elementsLength++,null!==e.querySelector("img")){e.classList.add("parvus-zoom");const t=document.createElement("div");t.className="parvus-zoom__indicator",t.innerHTML=p.lightboxIndicatorIcon,e.appendChild(t)}e.classList.add("parvus-trigger"),e.addEventListener("click",U),D(e)}else console.log("Ups, element already added.");else console.log(e,`Use a link with the 'href' attribute or a button with the 'data-target' attribute. Both attributes must have a path to the image file. Supported image file types: ${p.fileTypes}.`)},N=function(e){e.classList.contains("parvus-zoom")&&(e.classList.remove("parvus-zoom"),e.removeEventListener("click",U))},S=function(){h=document.createElement("div"),h.setAttribute("role","dialog"),h.setAttribute("aria-modal","true"),h.setAttribute("aria-hidden","true"),h.setAttribute("tabindex","-1"),h.setAttribute("aria-label",p.i18n[p.lang].lightboxLabel),h.classList.add("parvus"),m=document.createElement("div"),m.classList.add("parvus__overlay"),m.style.opacity=0,h.appendChild(m),v=document.createElement("button"),v.className="parvus__btn parvus__btn--close",v.setAttribute("type","button"),v.setAttribute("aria-label",p.i18n[p.lang].closeButtonLabel),v.innerHTML=p.closeButtonIcon,h.appendChild(v),document.body.appendChild(h)},q=function(){a[c].slider=document.createElement("div"),a[c].slider.className="parvus__slider",a[c].slider.setAttribute("aria-hidden","true"),h.appendChild(a[c].slider)},D=function(e){const t=document.createElement("div"),n=document.createElement("div");t.className="parvus__slide",t.style.position="absolute",t.style.left=100*a[c].x+"%",t.setAttribute("aria-hidden","true"),B(e,n),t.appendChild(n),a[c].slider.appendChild(t),a[c].sliderElements.push(t),++a[c].x},M=function(e){if(te())throw new Error("Ups, I'm aleady open.");L=document.activeElement;const t=window.location.href;history.pushState({parvus:"close"},"Image",t),a[u].currentIndex=e,Z();document.querySelectorAll('body > *:not([aria-hidden="true"])').forEach((e=>{e.setAttribute("aria-hidden","true"),e.classList.add("parvus-hidden")})),h.classList.add("parvus--is-opening"),h.setAttribute("aria-hidden","false"),W(),requestAnimationFrame((()=>{m.style.opacity=1,m.style.transition=`opacity ${w}ms ${p.transitionTimingFunction}`})),m.addEventListener("transitionend",(()=>{h.classList.remove("parvus--is-opening")}),{once:!0}),a[u].slider.setAttribute("aria-hidden","false"),k(a[u].currentIndex),z(),F(a[u].currentIndex),Y(a[u].currentIndex+1),Y(a[u].currentIndex-1);const n=new CustomEvent("open");h.dispatchEvent(n)},O=function(){if(!te())throw new Error("Ups, I'm already closed.");ee(),H(),null!==history.state&&"close"===history.state.parvus&&history.back();const e=new CustomEvent("close");h.dispatchEvent(e);document.querySelectorAll(".parvus-hidden").forEach((e=>{e.removeAttribute("aria-hidden"),e.classList.remove("parvus-hidden")})),h.classList.add("parvus--is-closing"),requestAnimationFrame((()=>{m.style.opacity=0,m.style.transition=`opacity ${w}ms ${p.transitionTimingFunction}`})),m.addEventListener("transitionend",(()=>{P(a[u].currentIndex),L.focus({preventScroll:!0}),h.classList.remove("parvus--is-closing"),a[u].slider.setAttribute("aria-hidden","true"),h.setAttribute("aria-hidden","true")}),{once:!0})},Y=function(e){a[u].sliderElements[e]},k=function(e){void 0!==a[u].sliderElements[e]&&(a[u].sliderElements[e].classList.add("parvus__slide--is-active"),a[u].sliderElements[e].setAttribute("aria-hidden","false"))},B=function(e,t){const n=document.createElement("figure"),i=document.createElement("figurecaption"),s=e.querySelector("img");g=document.createElement("img"),"A"===e.tagName?(g.setAttribute("data-src",e.href),g.alt=s?s.alt||"":e.getAttribute("data-alt")||""):(g.alt=e.getAttribute("data-alt")||"",g.setAttribute("data-src",e.getAttribute("data-target"))),n.appendChild(g),e.hasAttribute("data-caption")&&""!==e.getAttribute("data-caption")&&(i.innerHTML=e.getAttribute("data-caption"),n.appendChild(i)),t.appendChild(n)},F=function(e){const t=a[u].sliderElements[e],n=t.querySelector("img"),i=a[u].gallery[e],s=i.getBoundingClientRect(),c=document.createElement("div");console.log(i),n.hasAttribute("data-src")&&(n.style.opacity=0,c.className="parvus__loader",c.setAttribute("role","progressbar"),c.setAttribute("aria-label",p.i18n[p.lang].lightboxLOADING_INDICATORLabel),t.appendChild(c),n.onload=()=>{const e=n.getBoundingClientRect();t.removeChild(c),r=s.width/e.width,o=s.height/e.height,l=s.left-e.left,d=s.top-e.top,n.setAttribute("width",n.naturalWidth),n.setAttribute("height",n.naturalHeight),requestAnimationFrame((()=>{n.style.transform=`translate(${l}px, ${d}px) scale(${r}, ${o})`,n.style.transition="transform 0s, opacity 0s",requestAnimationFrame((()=>{n.style.transform="",n.style.opacity=1,n.style.transition=`transform ${w}ms ${p.transitionTimingFunction}, opacity ${w}ms ${p.transitionTimingFunction}`}))}))},n.setAttribute("src",n.getAttribute("data-src")),n.removeAttribute("data-src"))},P=function(e){void 0!==a[u].sliderElements[e]&&(a[u].sliderElements[e].classList.remove("parvus__slide--is-active"),a[u].sliderElements[e].setAttribute("aria-hidden","true"))},z=function(){u=null!==u?u:c,A=-a[u].currentIndex*h.offsetWidth,a[u].slider.style.transform=`translate3d(${A}px, 0, 0)`},H=function(){m.style.opacity=1,a[u].slider.style.transform="translate3d(0, 0, 0)",h.classList.remove("parvus--is-closing"),b={startY:0,endY:0}},U=function(e){e.preventDefault(),u=T(this),M(a[u].gallery.indexOf(this))},j=function(e){(e.target===v||!y&&e.target.classList.contains("parvus__overlay")&&p.docClose)&&O(),e.stopPropagation()},R=function(){return Array.prototype.slice.call(h.querySelectorAll(`${i.join(", ")}`)).filter((function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}))},W=function(){R()[0].focus()},J=function(e){const t=R(),n=t.indexOf(document.activeElement);"Tab"===e.code?e.shiftKey&&0===n?(t[t.length-1].focus(),e.preventDefault()):e.shiftKey||n!==t.length-1||(t[0].focus(),e.preventDefault()):"Escape"===e.code&&(e.preventDefault(),O())},K=function(){O()},G=function(e){e.stopPropagation(),y=!1,E=!0,b.startY=e.touches[0].pageY,a[u].slider.classList.add("parvus__image--is-dragging")},V=function(e){e.stopPropagation(),E&&(e.preventDefault(),b.endY=e.touches[0].pageY,X())},Q=function(e){e.stopPropagation(),E=!1,a[u].slider.classList.remove("parvus__image--is-dragging"),b.endY&&function(){const e=b.endY-b.startY;Math.abs(e)>p.threshold&&p.swipeClose&&O()}(),H()},X=function(){if(p.swipeClose&&!x){const e=b.endY-b.startY,t=Math.abs(e);t<=100&&(f=1-t/100),h.classList.add("parvus--is-closing"),m.style.opacity=f,a[u].slider.style.transform=`translate3d(0, ${Math.round(e)}px, 0)`,y=!0}},Z=function(){n.addEventListener("keydown",J),p.scrollClose&&n.addEventListener("wheel",K),n.addEventListener("popstate",O),h.addEventListener("click",j),ne()&&(h.addEventListener("touchstart",G),h.addEventListener("touchmove",V),h.addEventListener("touchend",Q))},ee=function(){n.removeEventListener("keydown",J),p.scrollClose&&n.removeEventListener("wheel",K),n.removeEventListener("popstate",O),h.removeEventListener("click",j),ne()&&(h.removeEventListener("touchstart",G),h.removeEventListener("touchmove",V),h.removeEventListener("touchend",Q))},te=function(){return"false"===h.getAttribute("aria-hidden")},ne=function(){return"ontouchstart"in window};return I(t),e.init=I,e.open=M,e.close=O,e.add=$,e.remove=N,e.destroy=function(){te()&&O();document.querySelectorAll(".parvus-zoom").forEach((e=>{N(e)}));const e=new CustomEvent("destroy");h.dispatchEvent(e)},e.isOpen=te,e.on=function(e,t){h.addEventListener(e,t)},e.off=function(e,t){h.removeEventListener(e,t)},e}}));

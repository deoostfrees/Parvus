/**
 * Parvus
 *
 * @author de Oostfreese
 * @version 1.0.1
 * @url https://github.com/deoostfreese/parvus
 *
 * MIT license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).parvus=e()}(this,(function(){"use strict";return function t(e){const n=window,o=["button:not([disabled]):not([inert])",NaN];let i,s,a,r,l={},c=null,u=null,d=null,p=null,m=null,f={},h=!1,v=!1,g=null;const y=window.matchMedia("(prefers-reduced-motion)"),b=function(t){l=function(t){return{selector:".lightbox",lightboxLabel:"This is a dialog window which overlays the main content of the page. The modal shows the enlarged image. Pressing the Escape key will close the modal and bring you back to where you were on the page.",lightboxLoadingIndicatorLabel:"Image loading",swipeClose:!0,scrollClose:!0,threshold:100,transitionDuration:300,transitionTimingFunction:"cubic-bezier(0.2, 0, 0.2, 1)",...t}}(t),c||w();document.querySelectorAll(l.selector).forEach(t=>{E(t)})},E=function(t){t.classList.contains("parvus-zoom")||(t.classList.add("parvus-zoom"),t.addEventListener("click",Y))},L=function(t){t.classList.contains("parvus-zoom")&&(t.classList.remove("parvus-zoom"),t.removeEventListener("click",Y))},w=function(){c=document.createElement("div"),c.setAttribute("role","dialog"),c.setAttribute("aria-hidden","true"),c.setAttribute("tabindex","0"),c.setAttribute("aria-label",l.lightboxLabel),c.classList.add("parvus"),u=document.createElement("div"),u.classList.add("parvus__overlay"),u.style.opacity=0,c.appendChild(u),d=document.createElement("div"),d.classList.add("parvus__image"),c.appendChild(d),document.body.appendChild(c)},C=function(t){if(P())throw new Error("Ups, I'm aleady open.");g=document.activeElement,y.matches&&(l.transitionDuration=1);const e=window.location.href;history.pushState({parvus:"close"},"Image",e),I(),m=document.createElement("div"),m.className="parvus__loader",m.setAttribute("role","progressbar"),m.setAttribute("aria-label",l.lightboxLoadingIndicatorLabel),c.appendChild(m),c.setAttribute("aria-hidden","false"),c.focus(),A(t);const n=new CustomEvent("open");c.dispatchEvent(n)},$=function(){if(!P())throw new Error("Ups, I'm already closed.");S(),x(),null!==history.state&&"close"===history.state.parvus&&history.back();const t=new CustomEvent("close");c.dispatchEvent(t),requestAnimationFrame(()=>{p.style.transition=`transform ${l.transitionDuration}ms ${l.transitionTimingFunction}`,p.style.transform=`translate(${a}px, ${r}px) scale(${i}, ${s})`,u.style.opacity=0,u.style.transition=`opacity ${l.transitionDuration}ms ${l.transitionTimingFunction}`}),p.addEventListener("transitionend",()=>{g.focus({preventScroll:!0}),c.setAttribute("aria-hidden","true"),p.remove()},{once:!0})},A=function(t){if(!t.href.match(/\.(png|jpe?g|gif|bmp|webp|svg)(\?.*)?$/i))return;p=document.createElement("img");const e=t.querySelector("img"),n=t.getBoundingClientRect();p.alt=e.alt||"",p.src=t.href,d.style.opacity="0",d.appendChild(p),p.onload=()=>{c.removeChild(m);const t=p.getBoundingClientRect();i=n.width/t.width,s=n.height/t.height,a=n.left-t.left,r=n.top-t.top,d.style.opacity="1",requestAnimationFrame(()=>{p.style.transform=`translate(${a}px, ${r}px) scale(${i}, ${s})`,p.style.transition="transform 0s",requestAnimationFrame(()=>{p.style.transform="",p.style.transition=`transform ${l.transitionDuration}ms ${l.transitionTimingFunction}`,u.style.opacity=1,u.style.transition=`opacity ${l.transitionDuration}ms ${l.transitionTimingFunction}`})})}},x=function(){d.style.transform="translate3d(0, 0, 0)",f={startY:0,endY:0}},Y=function(t){t.preventDefault(),C(this)},D=function(t){h||$(),t.stopPropagation()},T=function(t){const e=Array.prototype.slice.call(document.querySelectorAll(".parvus, .parvus + "+o.join(", .parvus "))).filter((function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)})),n=e.indexOf(document.activeElement);"Tab"===t.code?t.shiftKey&&0===n?(e[e.length-1].focus(),t.preventDefault()):t.shiftKey||n!==e.length-1||(e[0].focus(),t.preventDefault()):"Escape"===t.code&&(t.preventDefault(),$())},_=function(t){$()},k=function(t){t.stopPropagation(),h=!1,v=!0,f.startY=t.touches[0].pageY,d.classList.add("parvus__image--is-dragging")},F=function(t){t.stopPropagation(),v&&(t.preventDefault(),f.endY=t.touches[0].pageY,z())},q=function(t){t.stopPropagation(),v=!1,d.classList.remove("parvus__image--is-dragging"),f.endY&&function(){const t=f.endY-f.startY,e=Math.abs(t);t<0&&e>l.threshold&&l.swipeClose&&$()}(),x()},z=function(){Math.abs(f.startY-f.endY)>0&&l.swipeClose&&(d.style.transform=`translate3d(0, -${Math.round(f.startY-f.endY)}px, 0)`,h=!0)},I=function(){n.addEventListener("keydown",T),l.scrollClose&&n.addEventListener("wheel",_),n.addEventListener("popstate",$),c.addEventListener("click",D),M()&&(c.addEventListener("touchstart",k),c.addEventListener("touchmove",F),c.addEventListener("touchend",q))},S=function(){n.removeEventListener("keydown",T),l.scrollClose&&n.removeEventListener("wheel",_),n.removeEventListener("popstate",$),c.removeEventListener("click",D),M()&&(c.removeEventListener("touchstart",k),c.removeEventListener("touchmove",F),c.removeEventListener("touchend",q))},P=function(){return"false"===c.getAttribute("aria-hidden")},M=function(){return"ontouchstart"in window};return b(e),t.init=b,t.open=C,t.close=$,t.add=E,t.remove=L,t.destroy=function(){P()&&$();document.querySelectorAll(".parvus-zoom").forEach(t=>{L(t)});const t=new CustomEvent("destroy");c.dispatchEvent(t)},t.isOpen=P,t.on=function(t,e){c.addEventListener(t,e)},t.off=function(t,e){c.removeEventListener(t,e)},t}}));

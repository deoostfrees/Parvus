/**
 * Parvus
 *
 * @author Benjamin de Oostfrees
 * @version 2.0.0
 * @url https://github.com/deoostfrees/parvus
 *
 * MIT license
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Parvus=t()}(this,(function(){"use strict";var e={lightboxLabel:"This is a dialog window which overlays the main content of the page. The modal shows the enlarged image. Pressing the Escape key will close the modal and bring you back to where you were on the page.",lightboxLoadingIndicatorLabel:"Image loading",previousButtonLabel:"Previous image",nextButtonLabel:"Next image",closeButtonLabel:"Close dialog window"};return function t(n){const i=window,s=["button:not([disabled]):not([inert])",'[tabindex]:not([tabindex^="-"]):not([inert])'],r={gallery:[],slider:null,sliderElements:[]},a={};let o=null,l=null,d=0,u={},c=null,p=null,g=1,h=null,f=null,m=null,v=null,b=0,y=0,w=0,A=0,E={},L=!1,_=!1,x=!1,C=null,$=null,S=null,T=!1,B=null,M=!0;const q=window.matchMedia("(prefers-reduced-motion)"),I=function(){q.matches?(M=!0,B=u.reducedTransitionDuration):(M=!1,B=u.transitionDuration)};q.addEventListener("change",I);const X=function(t){u=function(t){return{selector:".lightbox",gallerySelector:null,captions:!0,captionsSelector:"self",captionsAttribute:"data-caption",docClose:!0,scrollClose:!1,swipeClose:!0,threshold:50,backFocus:!0,transitionDuration:300,reducedTransitionDuration:.1,transitionTimingFunction:"cubic-bezier(0.4, 0, 0.22, 1)",lightboxIndicatorIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/></svg>',previousButtonIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18" /></svg>',nextButtonIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="9 6 15 12 9 18" /></svg>',closeButtonIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M18 6L6 18M6 6l12 12"/></svg>',l10n:e,fileTypes:/\.(png|jpe?g|webp|avif|svg)(\?.*)?$/i,...t}}(t);if(document.querySelectorAll(u.selector).length)if(I(),c||N(),null!==u.gallerySelector){document.querySelectorAll(u.gallerySelector).forEach(((e,t)=>{const n=t;e.querySelectorAll(u.selector).forEach((e=>{e.setAttribute("data-group",`parvus-gallery-${n}`),k(e)}))}));document.querySelectorAll(`${u.selector}:not(.parvus-trigger)`).forEach((e=>{k(e)}))}else{document.querySelectorAll(u.selector).forEach((e=>{k(e)}))}},Y=function(e){const t=Math.floor(1e4*Math.random());return e.hasAttribute("data-group")&&""!==e.getAttribute("data-group")||e.setAttribute("data-group",`default-${t}`),e.getAttribute("data-group")},k=function(e){if(!("A"===e.tagName&&e.hasAttribute("href")&&e.href.match(u.fileTypes)||"BUTTON"===e.tagName&&e.hasAttribute("data-target")&&e.getAttribute("data-target").match(u.fileTypes)))throw new Error(e,`Use a link with the 'href' attribute or a button with the 'data-target' attribute. Both attributes must have a path to the image file. Supported image file types: ${u.fileTypes}.`);var t;if(o=Y(e),Object.prototype.hasOwnProperty.call(a,o)||(a[o]=(t=r,JSON.parse(JSON.stringify(t)))),a[o].gallery.includes(e))throw new Error("Ups, element already added.");if(a[o].gallery.push(e),null!==e.querySelector("img")){const t=document.createElement("div");e.classList.add("parvus-zoom"),t.className="parvus-zoom__indicator",t.innerHTML=u.lightboxIndicatorIcon,e.appendChild(t)}e.classList.add("parvus-trigger"),e.addEventListener("click",ie),be()&&o===l&&(D(e,a[o].gallery.indexOf(e)),R(a[o].gallery.indexOf(e)),te(),G(),Q())},F=function(e){if(be()||!c||!e||!e.hasAttribute("data-group"))return;const t=Y(e);if(!a[t].gallery.includes(e))throw new Error("Ups, I can't find the element.");if(a[t].gallery.splice(a[t].gallery.indexOf(e),1),e.classList.contains("parvus-zoom")){const t=e.querySelector(".parvus-zoom__indicator");e.classList.remove("parvus-zoom"),e.removeChild(t)}e.removeEventListener("click",ie),e.classList.remove("parvus-trigger")},N=function(){c=document.createElement("div"),c.setAttribute("role","dialog"),c.setAttribute("aria-modal","true"),c.setAttribute("aria-hidden","true"),c.setAttribute("tabindex","-1"),c.setAttribute("aria-label",u.l10n.lightboxLabel),c.classList.add("parvus"),p=document.createElement("div"),p.classList.add("parvus__overlay"),p.style.opacity=0,c.appendChild(p),m=document.createElement("button"),m.className="parvus__btn parvus__btn--close",m.setAttribute("type","button"),m.setAttribute("aria-label",u.l10n.closeButtonLabel),m.innerHTML=u.closeButtonIcon,c.appendChild(m),h=document.createElement("button"),h.className="parvus__btn parvus__btn--previous",h.setAttribute("type","button"),h.setAttribute("aria-label",u.l10n.previousButtonLabel),h.innerHTML=u.previousButtonIcon,c.appendChild(h),f=document.createElement("button"),f.className="parvus__btn parvus__btn--next",f.setAttribute("type","button"),f.setAttribute("aria-label",u.l10n.nextButtonLabel),f.innerHTML=u.nextButtonIcon,c.appendChild(f),v=document.createElement("div"),v.className="parvus__counter",c.appendChild(v),document.body.appendChild(c)},D=function(e,t){const n=document.createElement("div"),i=document.createElement("div");n.className="parvus__slide",n.style.position="absolute",n.style.left=100*t+"%",n.setAttribute("aria-hidden","true"),U(e,i),n.appendChild(i),a[l].sliderElements[t]=n,t===d&&a[l].slider.appendChild(n),t>d?a[l].sliderElements[d].after(n):a[l].sliderElements[d].before(n)},H=function(e){if(!c||!e||!e.classList.contains("parvus-trigger")||be())return;if(l=Y(e),!a[l].gallery.includes(e))throw new Error("Ups, I can't find the element.");d=a[l].gallery.indexOf(e),C=document.activeElement;const t=window.location.href;history.pushState({parvus:"close"},"Image",t),me();document.querySelectorAll('body > *:not([aria-hidden="true"])').forEach((e=>{e.setAttribute("aria-hidden","true"),e.classList.add("parvus-hidden")})),c.classList.add("parvus--is-opening"),c.setAttribute("aria-hidden","false"),a[l].slider=document.createElement("div"),a[l].slider.className="parvus__slider",a[l].slider.setAttribute("aria-hidden","true"),c.appendChild(a[l].slider),D(e,d),a[l].slider.setAttribute("aria-hidden","false"),V(),te(),Q(),ae(),P(d),R(d),requestAnimationFrame((()=>{c.classList.remove("parvus--is-opening"),p.style.opacity=1,p.style.transition=`opacity ${B}ms ${u.transitionTimingFunction}`,p.style.willChange="opacity"})),p.addEventListener("transitionend",(()=>{z(d+1),z(d-1)})),a[l].slider.classList.add("parvus__slider--animate");const n=new CustomEvent("open",{detail:{source:e}});c.dispatchEvent(n)},O=function(){if(!be())throw new Error("Ups, I'm already closed.");const e=a[l].sliderElements[d].querySelector("img"),t=e.getBoundingClientRect(),n=(u.backFocus?a[l].gallery[d]:C).getBoundingClientRect();ve(),Z(),null!==history.state&&"close"===history.state.parvus&&history.back();document.querySelectorAll(".parvus-hidden").forEach((e=>{e.removeAttribute("aria-hidden"),e.classList.remove("parvus-hidden")})),c.classList.add("parvus--is-closing"),requestAnimationFrame((()=>{b=n.width/t.width,y=n.height/t.height,w=n.left-t.left,A=n.top-t.top,e.style.transform=`translate(${w}px, ${A}px) scale(${b}, ${y})`,e.style.opacity=0,e.style.transition=`transform ${B}ms ${u.transitionTimingFunction}, opacity ${B}ms ${u.transitionTimingFunction} ${B/2}ms`,p.style.opacity=0,p.style.transition=`opacity ${B}ms ${u.transitionTimingFunction}`,p.style.willChange="auto"})),p.addEventListener("transitionend",(()=>{K(d),C=u.backFocus?a[l].gallery[d]:C,C.focus({preventScroll:!0}),c.setAttribute("aria-hidden","true"),c.classList.remove("parvus--is-closing"),c.classList.remove("parvus--is-vertical-closing"),a[l].slider.remove(),e.style.transform=""}),{once:!0});const i=new CustomEvent("close",{detail:{source:a[l].gallery[d]}});c.dispatchEvent(i)},z=function(e){void 0!==a[l].gallery[e]&&(D(a[l].gallery[e],e),R(e))},P=function(e){a[l].sliderElements[e].classList.add("parvus__slide--is-active"),a[l].sliderElements[e].setAttribute("aria-hidden","false")},U=function(e,t){const n=document.createElement("img"),i=document.createElement("figure"),s=document.createElement("figcaption"),r=e.querySelector("img"),a=document.createElement("div");if(a.className="parvus__loader",a.setAttribute("role","progressbar"),a.setAttribute("aria-label",u.l10n.lightboxLoadingIndicatorLabel),t.appendChild(a),n.onload=()=>{t.removeChild(a),n.setAttribute("width",n.naturalWidth),n.setAttribute("height",n.naturalHeight)},"A"===e.tagName?(n.setAttribute("src",e.href),n.alt=r?r.alt||"":e.getAttribute("data-alt")||""):(n.alt=e.getAttribute("data-alt")||"",n.setAttribute("src",e.getAttribute("data-target"))),e.hasAttribute("data-srcset")&&""!==e.getAttribute("data-srcset")&&n.setAttribute("srcset",e.getAttribute("data-srcset")),n.style.opacity=0,i.appendChild(n),u.captions){let t=null;if("self"===u.captionsSelector)e.hasAttribute(u.captionsAttribute)&&""!==e.getAttribute(u.captionsAttribute)&&(t=e.getAttribute(u.captionsAttribute));else if(null!==e.querySelector(u.captionsSelector)){const n=e.querySelector(u.captionsSelector);t=n.hasAttribute(u.captionsAttribute)&&""!==n.getAttribute(u.captionsAttribute)?n.getAttribute(u.captionsAttribute):n.innerHTML}null!==t&&(s.innerHTML=`<p>${t}</p>`,i.appendChild(s))}t.appendChild(i)},R=function(e){const t=a[l].sliderElements[e].querySelector("img"),n=t.getBoundingClientRect(),i=a[l].gallery[e].getBoundingClientRect();c.classList.contains("parvus--is-opening")?(b=i.width/n.width,y=i.height/n.height,w=i.left-n.left,A=i.top-n.top,requestAnimationFrame((()=>{t.style.transform=`translate(${w}px, ${A}px) scale(${b}, ${y})`,t.style.transition="transform 0s, opacity 0s",requestAnimationFrame((()=>{t.style.transform="",t.style.opacity=1,t.style.transition=`transform ${B}ms ${u.transitionTimingFunction}, opacity ${B/2}ms ${u.transitionTimingFunction}`}))}))):t.style.opacity=1},j=function(e){const t=d;if(!be())throw new Error("Ups, I'm closed.");if(!e&&0!==e)throw new Error("Ups, no slide specified.");if(e===d)throw new Error(`Ups, slide ${e} is already selected.`);if(-1===e||e>=a[l].gallery.length)throw new Error(`Ups, I can't find slide ${e}.`);K(t),P(e),R(e),e<t&&(d--,V(),te(),G("left"),z(e-1)),e>t&&(d++,V(),te(),G("right"),z(e+1)),Q();const n=new CustomEvent("select",{detail:{source:a[l].gallery[d]}});c.dispatchEvent(n)},W=function(){d>0&&j(d-1)},J=function(){d<a[l].gallery.length-1&&j(d+1)},K=function(e){a[l].sliderElements[e].classList.remove("parvus__slide--is-active"),a[l].sliderElements[e].setAttribute("aria-hidden","true")},V=function(){l=null!==l?l:o,$=-d*c.offsetWidth,a[l].slider.style.transform=`translate3d(${$}px, 0, 0)`,S=$},G=function(e){1===a[l].gallery.length?m.focus():0===d?f.focus():d===a[l].gallery.length-1||"left"===e?h.focus():f.focus()},Q=function(){v.textContent=`${d+1}/${a[l].gallery.length}`},Z=function(){E={startX:0,endX:0,startY:0,endY:0}},ee=function(){const e=E.endX-E.startX,t=E.endY-E.startY,n=Math.abs(e),i=Math.abs(t);L&&e>0&&n>=u.threshold&&d>0?W():L&&e<0&&n>=u.threshold&&d!==a[l].gallery.length-1?J():_&&i>0?i>=u.threshold&&u.swipeClose?O():(p.style.opacity=1,c.classList.remove("parvus--is-vertical-closing"),V()):V()},te=function(){(u.swipeClose&&!a[l].slider.classList.contains("parvus__slider--is-draggable")||a[l].gallery.length>1&&!a[l].slider.classList.contains("parvus__slider--is-draggable"))&&a[l].slider.classList.add("parvus__slider--is-draggable"),1===a[l].gallery.length?(h.setAttribute("aria-hidden","true"),h.disabled=!0,f.setAttribute("aria-hidden","true"),f.disabled=!0):0===d?(h.setAttribute("aria-hidden","true"),h.disabled=!0,f.setAttribute("aria-hidden","false"),f.disabled=!1):d===a[l].gallery.length-1?(h.setAttribute("aria-hidden","false"),h.disabled=!1,f.setAttribute("aria-hidden","true"),f.disabled=!0):(h.setAttribute("aria-hidden","false"),h.disabled=!1,f.setAttribute("aria-hidden","false"),f.disabled=!1),1===a[l].gallery.length?v.setAttribute("aria-hidden","true"):v.setAttribute("aria-hidden","false")},ne=function(){T||(T=!0,i.requestAnimationFrame((()=>{V(),T=!1})))},ie=function(e){e.preventDefault(),H(this)},se=function(e){e.target===h?W():e.target===f?J():(e.target===m||!_&&!L&&e.target.classList.contains("parvus__slide")&&u.docClose)&&O(),e.stopPropagation()},re=function(){return Array.prototype.slice.call(c.querySelectorAll(`${s.join(", ")}`)).filter((function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}))},ae=function(){re()[0].focus()},oe=function(e){const t=re(),n=t.indexOf(document.activeElement);"Tab"===e.code?e.shiftKey&&0===n?(t[t.length-1].focus(),e.preventDefault()):e.shiftKey||n!==t.length-1||(t[0].focus(),e.preventDefault()):"Escape"===e.code?(e.preventDefault(),O()):"ArrowLeft"===e.code?(e.preventDefault(),W()):"ArrowRight"===e.code&&(e.preventDefault(),J())},le=function(){O()},de=function(e){e.preventDefault(),e.stopPropagation(),L=!1,_=!1,x=!0,E.startX=e.pageX,E.startY=e.pageY,a[l].slider.classList.add("parvus__slider--is-dragging"),a[l].slider.style.willChange="transform"},ue=function(e){e.preventDefault(),x&&(E.endX=e.pageX,E.endY=e.pageY,fe())},ce=function(e){e.stopPropagation(),x=!1,a[l].slider.classList.remove("parvus__slider--is-dragging"),a[l].slider.style.willChange="auto",(E.endX||E.endY)&&ee(),Z()},pe=function(e){e.stopPropagation(),L=!1,_=!1,x=!0,E.startX=e.touches[0].pageX,E.startY=e.touches[0].pageY,a[l].slider.classList.add("parvus__slider--is-dragging"),a[l].slider.style.willChange="transform"},ge=function(e){e.stopPropagation(),x&&(e.preventDefault(),E.endX=e.touches[0].pageX,E.endY=e.touches[0].pageY,fe())},he=function(e){e.stopPropagation(),x=!1,a[l].slider.classList.remove("parvus__slider--is-dragging"),a[l].slider.style.willChange="auto",(E.endX||E.endY)&&ee(),Z()},fe=function(){const e=E.startX-E.endX,t=E.endY-E.startY,n=Math.abs(t);Math.abs(e)>0&&!_&&a[l].gallery.length>1?(a[l].slider.style.transform=`translate3d(${S-Math.round(e)}px, 0, 0)`,L=!0,_=!1):Math.abs(t)>0&&!L&&u.swipeClose&&(n<=96&&!M&&(g=1-n/100),c.classList.add("parvus--is-vertical-closing"),p.style.opacity=g,a[l].slider.style.transform=`translate3d(${S}px, ${Math.round(t)}px, 0)`,L=!1,_=!0)},me=function(){i.addEventListener("keydown",oe),i.addEventListener("resize",ne),u.scrollClose&&i.addEventListener("wheel",le),i.addEventListener("popstate",O),c.addEventListener("click",se),ye()&&(c.addEventListener("touchstart",pe),c.addEventListener("touchmove",ge),c.addEventListener("touchend",he)),c.addEventListener("mousedown",de),c.addEventListener("mouseup",ce),c.addEventListener("mousemove",ue)},ve=function(){i.removeEventListener("keydown",oe),i.removeEventListener("resize",ne),u.scrollClose&&i.removeEventListener("wheel",le),i.removeEventListener("popstate",O),c.removeEventListener("click",se),ye()&&(c.removeEventListener("touchstart",pe),c.removeEventListener("touchmove",ge),c.removeEventListener("touchend",he)),c.removeEventListener("mousedown",de),c.removeEventListener("mouseup",ce),c.removeEventListener("mousemove",ue)},be=function(){return"false"===c.getAttribute("aria-hidden")},ye=function(){return"ontouchstart"in window};return X(n),t.init=X,t.open=H,t.close=O,t.select=j,t.previous=W,t.next=J,t.currentIndex=function(){return d},t.add=k,t.remove=F,t.destroy=function(){if(!c)return;be()&&O(),c.remove();document.querySelectorAll(".parvus-trigger").forEach((e=>{F(e)}));const e=new CustomEvent("destroy");c.dispatchEvent(e)},t.isOpen=be,t.on=function(e,t){c&&c.addEventListener(e,t)},t.off=function(e,t){c&&c.removeEventListener(e,t)},t}}));

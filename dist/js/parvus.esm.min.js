/**
 * Parvus
 *
 * @author Benjamin de Oostfrees
 * @version 3.0.0
 * @url https://github.com/deoostfrees/parvus
 *
 * MIT license
 */

const e=['a:not([inert]):not([tabindex^="-"])','button:not([inert]):not([tabindex^="-"]):not(:disabled)','[tabindex]:not([inert]):not([tabindex^="-"])'],t=window,r=()=>t.innerWidth-document.documentElement.clientWidth;var n={lightboxLabel:"This is a dialog window that overlays the main content of the page. The modal displays the enlarged image. Pressing the Escape key will close the modal and bring you back to where you were on the page.",lightboxLoadingIndicatorLabel:"Image loading",lightboxLoadingError:"The requested image cannot be loaded.",controlsLabel:"Controls",previousButtonLabel:"Previous image",nextButtonLabel:"Next image",closeButtonLabel:"Close dialog window",sliderLabel:"Images",slideLabel:"Image"};function i(t){const i=window,s={triggerElements:[],slider:null,sliderElements:[],contentElements:[]},a={},o=new Map;let l=0,d=null,u=null,c=0,m={},p=null,g=null,h=1,b=null,v=null,f=null,E=null,y=null,A=null,w=null,L=null,_={},x=!1,C=!1,I=!1,k=1,M=!1,N=0,T=null,S=null,$=null,B=!1,z=!0;const q=i.matchMedia("(prefers-reduced-motion)"),X=()=>{z=!!q.matches},Y=e=>{if(e.dataset.group)return e.dataset.group;const t="default-"+l++;return e.dataset.group=t,t},H=e=>{const t="A"===e.tagName&&e.hasAttribute("href"),r="BUTTON"===e.tagName&&e.hasAttribute("data-target");if(!t&&!r)throw new Error("Use a link with the 'href' attribute or a button with the 'data-target' attribute. Both attributes must contain a path to the image file.");if(p||O(),d=Y(e),a[d]||(a[d]=structuredClone(s)),a[d].triggerElements.includes(e))throw new Error("Ups, element already added.");if(a[d].triggerElements.push(e),m.zoomIndicator&&((e,t)=>{if(e.querySelector("img")&&null===e.querySelector(".parvus-zoom__indicator")){const r=document.createElement("div");r.className="parvus-zoom__indicator",r.innerHTML=t.lightboxIndicatorIcon,e.appendChild(r)}})(e,m),e.classList.add("parvus-trigger"),e.addEventListener("click",ae),he()&&d===u){const t=a[d].triggerElements.indexOf(e);F(t),G(e,t,(()=>{U(t)})),ne(),ee(),te()}},D=e=>{if(!e||!e.hasAttribute("data-group"))return;const t=Y(e);if(!a[t]||!a[t].triggerElements.includes(e))return;const r=a[t].triggerElements.indexOf(e);a[t].triggerElements.splice(r,1),a[t].sliderElements.splice(r,1),m.zoomIndicator&&(e=>{if(e.querySelector("img")&&null!==e.querySelector(".parvus-zoom__indicator")){const t=e.querySelector(".parvus-zoom__indicator");e.removeChild(t)}})(e),he()&&t===u&&(ne(),ee(),te()),e.removeEventListener("click",ae),e.classList.remove("parvus-trigger")},O=()=>{const e=document.createDocumentFragment();p=document.createElement("dialog"),p.setAttribute("role","dialog"),p.setAttribute("aria-modal","true"),p.setAttribute("aria-label",m.l10n.lightboxLabel),p.classList.add("parvus"),g=document.createElement("div"),g.classList.add("parvus__overlay"),b=document.createElement("div"),b.className="parvus__toolbar",v=document.createElement("div"),f=document.createElement("div"),E=document.createElement("div"),E.className="parvus__controls",E.setAttribute("role","group"),E.setAttribute("aria-label",m.l10n.controlsLabel),w=document.createElement("button"),w.className="parvus__btn parvus__btn--close",w.setAttribute("type","button"),w.setAttribute("aria-label",m.l10n.closeButtonLabel),w.innerHTML=m.closeButtonIcon,y=document.createElement("button"),y.className="parvus__btn parvus__btn--previous",y.setAttribute("type","button"),y.setAttribute("aria-label",m.l10n.previousButtonLabel),y.innerHTML=m.previousButtonIcon,A=document.createElement("button"),A.className="parvus__btn parvus__btn--next",A.setAttribute("type","button"),A.setAttribute("aria-label",m.l10n.nextButtonLabel),A.innerHTML=m.nextButtonIcon,L=document.createElement("div"),L.className="parvus__counter",E.append(w,y,A),v.appendChild(L),f.appendChild(E),b.append(v,f),p.append(g,b),e.appendChild(p),document.body.appendChild(e)},F=e=>{if(void 0!==a[u].sliderElements[e])return;const t=document.createDocumentFragment(),r=document.createElement("div"),n=document.createElement("div"),i=a[u],s=i.triggerElements.length;if(r.className="parvus__slide",r.style.cssText=`\n      position: absolute;\n      left: ${100*e}%;\n    `,r.setAttribute("aria-hidden","true"),s>1&&(r.setAttribute("role","group"),r.setAttribute("aria-label",`${m.l10n.slideLabel} ${e+1}/${s}`)),r.appendChild(n),t.appendChild(r),i.sliderElements[e]=r,e>=c){const t=(e=>{const t=a[u].sliderElements,r=t.length;for(let n=e+1;n<r;n++)if(void 0!==t[n])return n;return-1})(e);-1!==t?i.sliderElements[t].before(r):i.slider.appendChild(r)}else{const t=(e=>{const t=a[u].sliderElements;for(let r=e-1;r>=0;r--)if(void 0!==t[r])return r;return-1})(e);-1!==t?i.sliderElements[t].after(r):i.slider.prepend(r)}},P=e=>{if(!p||!e||!e.classList.contains("parvus-trigger")||he())return;u=Y(e);const t=a[u],n=t.triggerElements.indexOf(e);if(-1===n)throw new Error("Ups, element not found in group.");c=n,history.pushState({parvus:"close"},"Image",window.location.href),pe(),m.hideScrollbar&&(document.body.style.marginInlineEnd=`${r()}px`,document.body.style.overflow="hidden"),p.classList.add("parvus--is-opening"),p.showModal(),(()=>{const e=document.createElement("div");e.className="parvus__slider",a[u].slider=e,p.appendChild(e)})(),F(c),Z(),ne(),ee(),te(),W(c),G(e,c,(()=>{U(c,!0),p.classList.remove("parvus--is-opening"),t.slider.classList.add("parvus__slider--animate")})),V(c+1),V(c-1),be("open")},j=()=>{if(!he())return;const e=a[u].contentElements[c],t=a[u].triggerElements[c];ge(),re(),"close"===history.state?.parvus&&history.back(),p.classList.add("parvus--is-closing");const r=()=>{Q(c),p.close(),p.classList.remove("parvus--is-closing"),p.classList.remove("parvus--is-vertical-closing"),a[u].slider.remove(),a[u].slider=null,a[u].sliderElements=[],a[u].contentElements=[],L.removeAttribute("aria-hidden"),y.removeAttribute("aria-hidden"),y.removeAttribute("aria-disabled"),A.removeAttribute("aria-hidden"),A.removeAttribute("aria-disabled"),m.hideScrollbar&&(document.body.style.marginInlineEnd="",document.body.style.overflow="")};if(e&&"IMG"===e.tagName)if(document.startViewTransition){e.style.viewTransitionName="lightboximage";document.startViewTransition((()=>{e.style.opacity="0",e.style.viewTransitionName=null,t.style.viewTransitionName="lightboximage"})).finished.finally((()=>{r(),t.style.viewTransitionName=null}))}else e.style.opacity="0",requestAnimationFrame(r);else r()},V=e=>{e<0||e>=a[u].triggerElements.length||void 0!==a[u].sliderElements[e]||(F(e),G(a[u].triggerElements[e],e,(()=>{U(e)})))},W=e=>{a[u].sliderElements[e].setAttribute("aria-hidden","false")},G=(e,t,r)=>{const{contentElements:n,sliderElements:i}=a[u];if(void 0!==n[t])return void(r&&"function"==typeof r&&r());const s=i[t].querySelector("div"),o=new Image,l=document.createElement("div"),d=e.querySelector("img"),c=document.createElement("div");l.className="parvus__content",c.className="parvus__loader",c.setAttribute("role","progressbar"),c.setAttribute("aria-label",m.l10n.lightboxLoadingIndicatorLabel),s.appendChild(c);new Promise(((e,t)=>{o.onload=()=>e(o),o.onerror=e=>t(e)})).then((r=>{r.style.opacity=0,l.appendChild(r),s.appendChild(l),m.captions&&((e,t,r,n)=>{const i=document.createElement("div");let s=null;if(i.className="parvus__caption","self"===m.captionsSelector)r.hasAttribute(m.captionsAttribute)&&""!==r.getAttribute(m.captionsAttribute)&&(s=r.getAttribute(m.captionsAttribute));else{const e=r.querySelector(m.captionsSelector);null!==e&&(s=e.hasAttribute(m.captionsAttribute)&&""!==e.getAttribute(m.captionsAttribute)?e.getAttribute(m.captionsAttribute):e.innerHTML)}if(null!==s){const r=`parvus__caption-${n}`;i.id=r,i.innerHTML=`<p>${s}</p>`,e.appendChild(i),t.setAttribute("aria-describedby",r)}})(s,o,e,t),n[t]=r,r.setAttribute("width",r.naturalWidth),r.setAttribute("height",r.naturalHeight),se(i[t],r)})).catch((()=>{const e=document.createElement("div");e.classList.add("parvus__content"),e.classList.add("parvus__content--error"),e.innerHTML=`${m.l10n.lightboxLoadingError}`,s.appendChild(e),n[t]=e})).finally((()=>{s.removeChild(c),r&&"function"==typeof r&&r()})),e.hasAttribute("data-sizes")&&""!==e.getAttribute("data-sizes")&&o.setAttribute("sizes",e.getAttribute("data-sizes")),e.hasAttribute("data-srcset")&&""!==e.getAttribute("data-srcset")&&o.setAttribute("srcset",e.getAttribute("data-srcset")),"A"===e.tagName?o.setAttribute("src",e.href):o.setAttribute("src",e.getAttribute("data-target")),d&&d.hasAttribute("alt")&&""!==d.getAttribute("alt")?o.alt=d.alt:e.hasAttribute("data-alt")&&""!==e.getAttribute("data-alt")?o.alt=e.getAttribute("data-alt"):o.alt=""},U=(e,t)=>{const r=a[u].contentElements[e];if(r&&"IMG"===r.tagName){const n=a[u].triggerElements[e];if(t&&document.startViewTransition){n.style.viewTransitionName="lightboximage";document.startViewTransition((()=>{r.style.opacity="",n.style.viewTransitionName=null,r.style.viewTransitionName="lightboximage"})).finished.finally((()=>{r.style.viewTransitionName=null}))}else r.style.opacity=""}else r.style.opacity=""},R=e=>{if(!he())throw new Error("Oops, I'm closed.");if("number"!=typeof e||isNaN(e))throw new Error("Oops, no slide specified.");const t=a[u],r=t.triggerElements;if(e===c)throw new Error(`Oops, slide ${e} is already selected.`);if(e<0||e>=r.length)throw new Error(`Oops, I can't find slide ${e}.`);const n=c;c=e,t.sliderElements[e]||(F(e),G(t.triggerElements[e],e,(()=>{U(e)}))),W(e),Z(),ee(),te(),V(e<n?e-1:e+1),Q(n),be("select")},K=()=>{c>0&&R(c-1)},J=()=>{const{triggerElements:e}=a[u];c<e.length-1&&R(c+1)},Q=e=>{void 0!==a[u].sliderElements[e]&&a[u].sliderElements[e].setAttribute("aria-hidden","true")},Z=()=>{u=null!==u?u:d,S=-c*p.offsetWidth,a[u].slider.style.transform=`translate3d(${S}px, 0, 0)`,$=S},ee=()=>{const{triggerElements:e}=a[u],t=e.length;if(t<=1)return;const r=c===t-1,n=0===c?"true":null;"true"===y.getAttribute("aria-disabled")!=!!n&&(n?y.setAttribute("aria-disabled","true"):y.removeAttribute("aria-disabled"));const i=r?"true":null;"true"===A.getAttribute("aria-disabled")!=!!i&&(i?A.setAttribute("aria-disabled","true"):A.removeAttribute("aria-disabled"))},te=()=>{L.textContent=`${c+1}/${a[u].triggerElements.length}`},re=()=>{_={startX:0,endX:0,startY:0,endY:0}},ne=()=>{const e=a[u].triggerElements.length,t=a[u].slider,r=a[u].sliderElements,n=t.classList.contains("parvus__slider--is-draggable");m.simulateTouch&&m.swipeClose&&!n||m.simulateTouch&&e>1&&!n?t.classList.add("parvus__slider--is-draggable"):t.classList.remove("parvus__slider--is-draggable"),e>1?(t.setAttribute("role","region"),t.setAttribute("aria-roledescription","carousel"),t.setAttribute("aria-label",m.l10n.sliderLabel),r.forEach(((t,r)=>{t.setAttribute("role","group"),t.setAttribute("aria-label",`${m.l10n.slideLabel} ${r+1}/${e}`)}))):(t.removeAttribute("role"),t.removeAttribute("aria-roledescription"),t.removeAttribute("aria-label"),r.forEach((e=>{e.removeAttribute("role"),e.removeAttribute("aria-label")}))),1===e?(L.setAttribute("aria-hidden","true"),y.setAttribute("aria-hidden","true"),A.setAttribute("aria-hidden","true")):(L.removeAttribute("aria-hidden"),y.removeAttribute("aria-hidden"),A.removeAttribute("aria-hidden"))},ie=()=>{B||(B=!0,i.requestAnimationFrame((()=>{a[u].sliderElements.forEach(((e,t)=>{se(e,a[u].contentElements[t])})),Z(),B=!1})))},se=(e,t)=>{if("IMG"!==t.tagName)return;const r=t.getAttribute("height"),n=t.getAttribute("width");if(!r||!n)return;const i=getComputedStyle(e),s=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),a=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom),o=e.querySelector(".parvus__caption"),l=o?o.getBoundingClientRect().height:0,d=e.offsetWidth-s,u=e.offsetHeight-a-l,c=Math.min(d/n||0,u/r||0),m=n*c,p=r*c,g=n<=d&&r<=u;t.style.width=g?"":`${m}px`,t.style.height=g?"":`${p}px`},ae=function(e){e.preventDefault(),P(this)},oe=e=>{const{target:t}=e;t===y?K():t===A?J():(t===w||m.docClose&&!C&&!x&&t.classList.contains("parvus__slide"))&&j(),e.stopPropagation()},le=t=>{const r=(n=p,Array.from(n.querySelectorAll(e.join(", "))).filter((e=>null!==e.offsetParent)));var n;const i=r.indexOf(document.activeElement),s=r.length-1;switch(t.code){case"Tab":t.shiftKey?0===i&&(r[s].focus(),t.preventDefault()):i===s&&(r[0].focus(),t.preventDefault());break;case"Escape":j(),t.preventDefault();break;case"ArrowLeft":K(),t.preventDefault();break;case"ArrowRight":J(),t.preventDefault()}},de=e=>{e.preventDefault(),e.stopPropagation(),x=!1,C=!1,I=!0,o.set(e.pointerId,e),_.startX=e.pageX,_.startY=e.pageY,_.endX=e.pageX,_.endY=e.pageY;const{slider:t}=a[u];t.classList.add("parvus__slider--is-dragging"),t.style.willChange="transform",m.swipeClose&&(h=getComputedStyle(g).opacity)},ue=e=>{if(e.preventDefault(),!I)return;const t=a[u].contentElements[c];if(o.set(e.pointerId,e),t&&"IMG"===t.tagName){if(2===o.size)return void(e=>{const t=Array.from(o.values()),r=Math.hypot(t[1].clientX-t[0].clientX,t[1].clientY-t[0].clientY),n=t.map((e=>e.pointerId)).sort().join("-");M&&T===n||(M=!0,T=n,N=r/k,p.classList.add("parvus--is-zooming"));const i=r/N;k=Math.min(Math.max(1,i),3),e.style.willChange="transform",e.style.transform=`scale(${k})`})(t);if(k>1)return}_.endX=e.pageX,_.endY=e.pageY,me()},ce=e=>{e.stopPropagation();const{slider:t}=a[u];if(o.delete(e.pointerId),o.size>0)return;I=!1;const r=a[u].contentElements[c];t.classList.remove("parvus__slider--is-dragging"),t.style.willChange="",k>1?r.style.transform=`\n          scale(${k})\n        `:(M&&(r.style.transition="transform 0.3s ease",r.style.transform="",setTimeout((()=>{r.style.transition=""}),300),M=!1,k=1,N=0,T="",p.classList.remove("parvus--is-zooming")),(_.endX||_.endY)&&(()=>{const{startX:e,startY:t,endX:r,endY:n}=_,i=r-e,s=n-t,o=Math.abs(i),l=Math.abs(s),{triggerElements:d}=a[u],h=d.length;if(x){const e=i>0;o>=m.threshold&&(e&&c>0?K():!e&&c<h-1&&J()),Z()}else C?(l>=m.threshold&&m.swipeClose?j():(p.classList.remove("parvus--is-vertical-closing"),Z()),g.style.opacity=""):Z()})()),re()},me=()=>{const{startX:e,endX:t,startY:r,endY:n}=_,i=e-t,s=n-r,o=Math.abs(i),l=Math.abs(s);if(o>2&&!C&&a[u].triggerElements.length>1)a[u].slider.style.transform=`translate3d(${$-Math.round(i)}px, 0, 0)`,x=!0,C=!1;else if(l>2&&!x&&m.swipeClose){if(!z&&l<=100){const e=Math.max(0,h-l/100);g.style.opacity=e}p.classList.add("parvus--is-vertical-closing"),a[u].slider.style.transform=`translate3d(${$}px, ${Math.round(s)}px, 0)`,x=!1,C=!0}},pe=()=>{i.addEventListener("keydown",le),i.addEventListener("resize",ie),i.addEventListener("popstate",j),q.addEventListener("change",X),p.addEventListener("click",oe),p.addEventListener("pointerdown",de),p.addEventListener("pointerup",ce),p.addEventListener("pointermove",ue)},ge=()=>{i.removeEventListener("keydown",le),i.removeEventListener("resize",ie),i.removeEventListener("popstate",j),q.removeEventListener("change",X),p.removeEventListener("click",oe),p.removeEventListener("pointerdown",de),p.removeEventListener("pointerup",ce),p.removeEventListener("pointermove",ue)},he=()=>p.hasAttribute("open"),be=e=>{const t=new CustomEvent(e,{cancelable:!0});p.dispatchEvent(t)},ve=()=>{if(m=(e=>{const t={selector:".lightbox",gallerySelector:null,zoomIndicator:!0,captions:!0,captionsSelector:"self",captionsAttribute:"data-caption",docClose:!0,swipeClose:!0,simulateTouch:!0,threshold:50,hideScrollbar:!0,lightboxIndicatorIcon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true" focusable="false" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" stroke="currentColor"><path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/></svg>',previousButtonIcon:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" aria-hidden="true" focusable="false" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" stroke="currentColor"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18" /></svg>',nextButtonIcon:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" aria-hidden="true" focusable="false" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" stroke="currentColor"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="9 6 15 12 9 18" /></svg>',closeButtonIcon:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" aria-hidden="true" focusable="false" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" stroke="currentColor"><path d="M18 6L6 18M6 6l12 12"/></svg>',l10n:n},r={...t,...e};return e&&e.l10n&&(r.l10n={...t.l10n,...e.l10n}),r})(t),X(),null!==m.gallerySelector){document.querySelectorAll(m.gallerySelector).forEach(((e,t)=>{const r=t;e.querySelectorAll(m.selector).forEach((e=>{e.setAttribute("data-group",`parvus-gallery-${r}`),H(e)}))}))}document.querySelectorAll(`${m.selector}:not(.parvus-trigger)`).forEach(H)};return ve(),{init:ve,open:P,close:j,select:R,previous:K,next:J,currentIndex:()=>c,add:H,remove:D,destroy:()=>{if(!p)return;he()&&j(),p.remove();document.querySelectorAll(".parvus-trigger").forEach(D),be("destroy")},isOpen:he,on:(e,t)=>{p&&p.addEventListener(e,t)},off:(e,t)=>{p&&p.removeEventListener(e,t)}}}export{i as default};

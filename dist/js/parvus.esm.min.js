/**
 * Parvus
 *
 * @author de Oostfreese
 * @version 1.3.0
 * @url https://github.com/deoostfreese/parvus
 *
 * MIT license
 */
function e(t){const n=window,s=["button:not([disabled]):not([inert])",'[tabindex]:not([tabindex^="-"]):not([inert])'],i={gallery:[],slider:null,sliderElements:[],elementsLength:0,currentIndex:0,x:0},a={};let r,o,l,d,u=null,c=null,p={},h=null,m=null,g=0,v=null,f=null,b={},y=!1,L=!1,E=!1,A=null,w=null,x=null,_=null,C=!0;const I=window.matchMedia("(prefers-reduced-motion)"),T=function(){I.matches?(C=!0,_=p.reducedTransitionDuration):(C=!1,_=p.transitionDuration)};I.addEventListener("change",T);const $=function(e){p=function(e){return{selector:".lightbox",docClose:!0,scrollClose:!1,swipeClose:!0,threshold:100,transitionDuration:300,reducedTransitionDuration:1,transitionTimingFunction:"cubic-bezier(0.2, 0, 0.2, 1)",lightboxIndicatorIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/></svg>',closeButtonIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M18 6L6 18M6 6l12 12"/></svg>',lang:"en",i18n:{en:{lightboxLabel:"This is a dialog window which overlays the main content of the page. The modal shows the enlarged image. Pressing the Escape key will close the modal and bring you back to where you were on the page.",lightboxLoadingIndicatorLabel:"Image loading",closeButtonLabel:"Close dialog window"}},fileTypes:/\.(png|jpe?g|gif|bmp|webp|svg)(\?.*)?$/i,...e}}(e),T(),h||D();document.querySelectorAll(p.selector).forEach((e=>{X(e)}))},M=function(e){return e.hasAttribute("data-group")?e.getAttribute("data-group"):"default"},X=function(e){var t;if("A"===e.tagName&&e.hasAttribute("href")&&e.href.match(p.fileTypes)||"BUTTON"===e.tagName&&e.hasAttribute("data-target")&&e.getAttribute("data-target").match(p.fileTypes))if(u=M(e),Object.prototype.hasOwnProperty.call(a,u)||(a[u]=(t=i,JSON.parse(JSON.stringify(t))),N()),-1===a[u].gallery.indexOf(e)){if(a[u].gallery.push(e),a[u].elementsLength++,null!==e.querySelector("img")){e.classList.add("parvus-zoom");const t=document.createElement("div");t.className="parvus-zoom__indicator",t.innerHTML=p.lightboxIndicatorIcon,e.appendChild(t)}e.classList.add("parvus-trigger"),e.addEventListener("click",W),S(e),le()&&u===c&&j()}else console.log("Ups, element already added.");else console.log(e,`Use a link with the 'href' attribute or a button with the 'data-target' attribute. Both attributes must have a path to the image file. Supported image file types: ${p.fileTypes}.`)},Y=function(e){e.classList.contains("parvus-zoom")&&(e.classList.remove("parvus-zoom"),e.removeEventListener("click",W))},D=function(){h=document.createElement("div"),h.setAttribute("role","dialog"),h.setAttribute("aria-modal","true"),h.setAttribute("aria-hidden","true"),h.setAttribute("tabindex","-1"),h.setAttribute("aria-label",p.i18n[p.lang].lightboxLabel),h.classList.add("parvus"),m=document.createElement("div"),m.classList.add("parvus__overlay"),m.style.opacity=0,h.appendChild(m),f=document.createElement("button"),f.className="parvus__btn parvus__btn--close",f.setAttribute("type","button"),f.setAttribute("aria-label",p.i18n[p.lang].closeButtonLabel),f.innerHTML=p.closeButtonIcon,h.appendChild(f),document.body.appendChild(h)},N=function(){a[u].slider=document.createElement("div"),a[u].slider.className="parvus__slider",a[u].slider.setAttribute("aria-hidden","true"),h.appendChild(a[u].slider)},S=function(e){const t=document.createElement("div"),n=document.createElement("div");t.className="parvus__slide",t.style.position="absolute",t.style.left=100*a[u].x+"%",t.setAttribute("aria-hidden","true"),F(e,n),t.appendChild(n),a[u].slider.appendChild(t),a[u].sliderElements.push(t),++a[u].x},q=function(e){if(le())throw new Error("Ups, I'm aleady open.");j(),A=document.activeElement;const t=window.location.href;history.pushState({parvus:"close"},"Image",t),a[c].currentIndex=e,re();document.querySelectorAll('body > *:not([aria-hidden="true"])').forEach((e=>{e.setAttribute("aria-hidden","true"),e.classList.add("parvus-hidden")})),h.classList.add("parvus--is-opening"),h.setAttribute("aria-hidden","false"),G(),requestAnimationFrame((()=>{m.style.opacity=1,m.style.transition=`opacity ${_}ms ${p.transitionTimingFunction}`})),m.addEventListener("transitionend",(()=>{h.classList.remove("parvus--is-opening")}),{once:!0}),a[c].slider.setAttribute("aria-hidden","false"),B(a[c].currentIndex),H(),P(a[c].currentIndex),k(a[c].currentIndex+1),k(a[c].currentIndex-1);const n=new CustomEvent("open");h.dispatchEvent(n)},O=function(){if(!le())throw new Error("Ups, I'm already closed.");oe(),U(),null!==history.state&&"close"===history.state.parvus&&history.back();const e=new CustomEvent("close");h.dispatchEvent(e);document.querySelectorAll(".parvus-hidden").forEach((e=>{e.removeAttribute("aria-hidden"),e.classList.remove("parvus-hidden")})),h.classList.add("parvus--is-closing"),requestAnimationFrame((()=>{m.style.opacity=0,m.style.transition=`opacity ${_}ms ${p.transitionTimingFunction}`})),m.addEventListener("transitionend",(()=>{z(a[c].currentIndex),A.focus({preventScroll:!0}),h.classList.remove("parvus--is-closing"),a[c].slider.setAttribute("aria-hidden","true"),h.setAttribute("aria-hidden","true")}),{once:!0})},k=function(e){a[c].sliderElements[e]},B=function(e){void 0!==a[c].sliderElements[e]&&(a[c].sliderElements[e].classList.add("parvus__slide--is-active"),a[c].sliderElements[e].setAttribute("aria-hidden","false"))},F=function(e,t){const n=document.createElement("figure"),s=document.createElement("figurecaption"),i=e.querySelector("img");v=document.createElement("img"),"A"===e.tagName?(v.setAttribute("data-src",e.href),v.alt=i?i.alt||"":e.getAttribute("data-alt")||""):(v.alt=e.getAttribute("data-alt")||"",v.setAttribute("data-src",e.getAttribute("data-target"))),n.appendChild(v),e.hasAttribute("data-caption")&&""!==e.getAttribute("data-caption")&&(s.innerHTML=e.getAttribute("data-caption"),n.appendChild(s)),t.appendChild(n)},P=function(e){const t=a[c].sliderElements[e],n=t.querySelector("img"),s=a[c].gallery[e],i=s.getBoundingClientRect(),u=document.createElement("div");console.log(s),n.hasAttribute("data-src")&&(n.style.opacity=0,u.className="parvus__loader",u.setAttribute("role","progressbar"),u.setAttribute("aria-label",p.i18n[p.lang].lightboxLOADING_INDICATORLabel),t.appendChild(u),n.onload=()=>{const e=n.getBoundingClientRect();t.removeChild(u),r=i.width/e.width,o=i.height/e.height,l=i.left-e.left,d=i.top-e.top,n.setAttribute("width",n.naturalWidth),n.setAttribute("height",n.naturalHeight),requestAnimationFrame((()=>{n.style.transform=`translate(${l}px, ${d}px) scale(${r}, ${o})`,n.style.transition="transform 0s, opacity 0s",requestAnimationFrame((()=>{n.style.transform="",n.style.opacity=1,n.style.transition=`transform ${_}ms ${p.transitionTimingFunction}, opacity ${_}ms ${p.transitionTimingFunction}`}))}))},n.setAttribute("src",n.getAttribute("data-src")),n.removeAttribute("data-src"))},z=function(e){void 0!==a[c].sliderElements[e]&&(a[c].sliderElements[e].classList.remove("parvus__slide--is-active"),a[c].sliderElements[e].setAttribute("aria-hidden","true"))},H=function(){c=null!==c?c:u,w=-a[c].currentIndex*h.offsetWidth,a[c].slider.style.transform=`translate3d(${w}px, 0, 0)`,x=w},U=function(){m.style.opacity=1,a[c].slider.style.transform="translate3d(0, 0, 0)",h.classList.remove("parvus--is-closing"),b={startY:0,endY:0}},R=function(){const e=b.endX-b.startX,t=b.endY-b.startY,n=Math.abs(e),s=Math.abs(t);e>0&&n>p.threshold&&a[c].currentIndex>0||e<0&&n>p.threshold&&a[c].currentIndex!==a[c].elementsLength-1||(s>p.threshold&&p.swipeClose?O():H())},j=function(){(p.swipeClose&&!a[c].slider.classList.contains("parvus__slider--is-draggable")||a[c].elementsLength>1&&!a[c].slider.classList.contains("parvus__slider--is-draggable"))&&a[c].slider.classList.add("parvus__slider--is-draggable")},W=function(e){e.preventDefault(),c=M(this),q(a[c].gallery.indexOf(this))},J=function(e){(e.target===f||!L&&!y&&e.target.classList.contains("parvus__slide")&&p.docClose)&&O(),e.stopPropagation()},K=function(){return Array.prototype.slice.call(h.querySelectorAll(`${s.join(", ")}`)).filter((function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}))},G=function(){K()[0].focus()},V=function(e){const t=K(),n=t.indexOf(document.activeElement);"Tab"===e.code?e.shiftKey&&0===n?(t[t.length-1].focus(),e.preventDefault()):e.shiftKey||n!==t.length-1||(t[0].focus(),e.preventDefault()):"Escape"===e.code&&(e.preventDefault(),O())},Q=function(){O()},Z=function(e){e.preventDefault(),e.stopPropagation(),y=!1,L=!1,E=!0,b.startX=e.pageX,b.startY=e.pageY,a[c].slider.classList.add("parvus__slider--is-dragging")},ee=function(e){e.preventDefault(),E&&(b.endX=e.pageX,b.endY=e.pageY,ae())},te=function(e){e.stopPropagation(),E=!1,a[c].slider.classList.remove("parvus__slider--is-dragging"),b.endX&&R(),U()},ne=function(e){e.stopPropagation(),y=!1,L=!1,E=!0,b.startX=e.touches[0].pageX,b.startY=e.touches[0].pageY,a[c].slider.classList.add("parvus__slider--is-dragging")},se=function(e){e.stopPropagation(),E&&(e.preventDefault(),b.endX=e.touches[0].pageX,b.endY=e.touches[0].pageY,ae())},ie=function(e){e.stopPropagation(),E=!1,a[c].slider.classList.remove("parvus__slider--is-dragging"),b.endX&&R(),U()},ae=function(){const e=b.startX-b.endX,t=b.endY-b.startY;if(Math.abs(e)>0&&!L&&a[c].elementsLength>1)a[c].slider.style.transform=`translate3d(${x-Math.round(e)}px, 0, 0)`,y=!0,L=!1;else if(Math.abs(t)>0&&!y&&p.swipeClose&&p.swipeClose&&!C){const e=Math.abs(t);e<=100&&(g=1-e/100),h.classList.add("parvus--is-closing"),m.style.opacity=g,a[c].slider.style.transform=`translate3d(0, ${Math.round(t)}px, 0)`,y=!1,L=!0}},re=function(){n.addEventListener("keydown",V),p.scrollClose&&n.addEventListener("wheel",Q),n.addEventListener("popstate",O),h.addEventListener("click",J),de()&&(h.addEventListener("touchstart",ne),h.addEventListener("touchmove",se),h.addEventListener("touchend",ie)),h.addEventListener("mousedown",Z),h.addEventListener("mouseup",te),h.addEventListener("mousemove",ee)},oe=function(){n.removeEventListener("keydown",V),p.scrollClose&&n.removeEventListener("wheel",Q),n.removeEventListener("popstate",O),h.removeEventListener("click",J),de()&&(h.removeEventListener("touchstart",ne),h.removeEventListener("touchmove",se),h.removeEventListener("touchend",ie)),h.removeEventListener("mousedown",Z),h.removeEventListener("mouseup",te),h.removeEventListener("mousemove",ee)},le=function(){return"false"===h.getAttribute("aria-hidden")},de=function(){return"ontouchstart"in window};return $(t),e.init=$,e.open=q,e.close=O,e.add=X,e.remove=Y,e.destroy=function(){le()&&O();document.querySelectorAll(".parvus-zoom").forEach((e=>{Y(e)}));const e=new CustomEvent("destroy");h.dispatchEvent(e)},e.isOpen=le,e.on=function(e,t){h.addEventListener(e,t)},e.off=function(e,t){h.removeEventListener(e,t)},e}export default e;
